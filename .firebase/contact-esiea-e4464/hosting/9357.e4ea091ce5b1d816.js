"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9357],{5079:(n6,h2,X)=>{X.d(h2,{a:()=>K2});var T1,K2=function(m){Object.keys(m).forEach(function(k){h(k,m[k]);var H=k.replace(/([a-z0-9]|(?=[A-Z]))([A-Z0-9])/g,"$1-$2").toLowerCase();k!==H&&h(H,m[k])})},h=function(m,k){var H=function(){if(typeof window>"u")return new Map;if(!T1){var m=window;m.Ionicons=m.Ionicons||{},T1=m.Ionicons.map=m.Ionicons.map||new Map}return T1}(),b=H.get(m);void 0===b?H.set(m,k):b!==k&&console.warn('[Ionicons Warning]: Multiple icons were mapped to name "'.concat(m,'". Ensure that multiple icons are not mapped to the same icon name.'))}},5891:(n6,h2,X)=>{X.d(h2,{C3:()=>rt,Zy:()=>Y3,KR:()=>Q3,hZ:()=>s4});var T1=X(467),J=X(7852),K2=X(1362),h=X(1076),v2=X(8041);const g2="@firebase/database";let d1="";class N1{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,n){null==n?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),(0,h.As)(n))}get(t){const n=this.domStorage_.getItem(this.prefixedName_(t));return null==n?null:(0,h.$L)(n)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class z1{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,n){null==n?delete this.cache_[t]:this.cache_[t]=n}get(t){return(0,h.gR)(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const $2=function(s){try{if(typeof window<"u"&&typeof window[s]<"u"){const t=window[s];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new N1(t)}}catch{}return new z1},s1=$2("localStorage"),m=$2("sessionStorage"),k=new v2.Vy("@firebase/database"),H=function(){let s=1;return function(){return s++}}(),b=function(s){const t=(0,h.kj)(s),n=new h.gz;n.update(t);const o=n.digest();return h.K3.encodeByteArray(o)},W=function(...s){let t="";for(let n=0;n<s.length;n++){const o=s[n];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?t+=W.apply(null,o):t+="object"==typeof o?(0,h.As)(o):o,t+=" "}return t};let Z=null,e4=!0;const V=function(...s){if(!0===e4&&(e4=!1,null===Z&&!0===m.get("logging_enabled")&&function(s,t){(0,h.vA)(!t||!0===s||!1===s,"Can't turn on custom loggers persistently."),!0===s?(k.logLevel=v2.$b.VERBOSE,Z=k.log.bind(k),t&&m.set("logging_enabled",!0)):"function"==typeof s?Z=s:(Z=null,m.remove("logging_enabled"))}(!0)),Z){const t=W.apply(null,s);Z(t)}},R1=function(s){return function(...t){V(s,...t)}},X2=function(...s){const t="FIREBASE INTERNAL ERROR: "+W(...s);k.error(t)},G=function(...s){const t=`FIREBASE FATAL ERROR: ${W(...s)}`;throw k.error(t),new Error(t)},j=function(...s){const t="FIREBASE WARNING: "+W(...s);k.warn(t)},w2=function(s){return"number"==typeof s&&(s!=s||s===Number.POSITIVE_INFINITY||s===Number.NEGATIVE_INFINITY)},o1="[MIN_NAME]",t1="[MAX_NAME]",w1=function(s,t){if(s===t)return 0;if(s===o1||t===t1)return-1;if(t===o1||s===t1)return 1;{const n=r4(s),o=r4(t);return null!==n?null!==o?n-o==0?s.length-t.length:n-o:-1:null!==o?1:s<t?-1:1}},i6=function(s,t){return s===t?0:s<t?-1:1},P1=function(s,t){if(t&&s in t)return t[s];throw new Error("Missing required key ("+s+") in object: "+(0,h.As)(t))},J2=function(s){if("object"!=typeof s||null===s)return(0,h.As)(s);const t=[];for(const o in s)t.push(o);t.sort();let n="{";for(let o=0;o<t.length;o++)0!==o&&(n+=","),n+=(0,h.As)(t[o]),n+=":",n+=J2(s[t[o]]);return n+="}",n},l4=function(s,t){const n=s.length;if(n<=t)return[s];const o=[];for(let i=0;i<n;i+=t)o.push(s.substring(i,i+t>n?n:i+t));return o};function O(s,t){for(const n in s)s.hasOwnProperty(n)&&t(n,s[n])}const c4=function(s){(0,h.vA)(!w2(s),"Invalid JSON number");const o=1023;let i,e,a,l,c;0===s?(e=0,a=0,i=1/s==-1/0?1:0):(i=s<0,(s=Math.abs(s))>=Math.pow(2,1-o)?(l=Math.min(Math.floor(Math.log(s)/Math.LN2),o),e=l+o,a=Math.round(s*Math.pow(2,52-l)-Math.pow(2,52))):(e=0,a=Math.round(s/Math.pow(2,-1074))));const r=[];for(c=52;c;c-=1)r.push(a%2?1:0),a=Math.floor(a/2);for(c=11;c;c-=1)r.push(e%2?1:0),e=Math.floor(e/2);r.push(i?1:0),r.reverse();const v=r.join("");let g="";for(c=0;c<64;c+=8){let d=parseInt(v.substr(c,8),2).toString(16);1===d.length&&(d="0"+d),g+=d}return g.toLowerCase()},c6=new RegExp("^-?(0*)\\d{1,10}$"),r4=function(s){if(c6.test(s)){const t=Number(s);if(t>=-2147483648&&t<=2147483647)return t}return null},_1=function(s){try{s()}catch(t){setTimeout(()=>{throw j("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},D1=function(s,t){const n=setTimeout(s,t);return"number"==typeof n&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class g6{constructor(t,n){this.appName_=t,this.appCheckProvider=n,this.appCheck=null==n?void 0:n.getImmediate({optional:!0}),this.appCheck||null==n||n.get().then(o=>this.appCheck=o)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((n,o)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(n,o):n(null)},0)})}addTokenChangeListener(t){var n;null===(n=this.appCheckProvider)||void 0===n||n.get().then(o=>o.addTokenListener(t))}notifyForInvalidToken(){j(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class d6{constructor(t,n,o){this.appName_=t,this.firebaseOptions_=n,this.authProvider_=o,this.auth_=null,this.auth_=o.getImmediate({optional:!0}),this.auth_||o.onInit(i=>this.auth_=i)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(n=>n&&"auth/token-not-initialized"===n.code?(V("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,o)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(n,o):n(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(n=>n.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(n=>n.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',j(t)}}let F1=(()=>{class s{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}return s.OWNER="owner",s})();const w4=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,p4="websocket",x4="long_polling";class t0{constructor(t,n,o,i,e=!1,a="",l=!1,c=!1){this.secure=n,this.namespace=o,this.webSocketOnly=i,this.nodeAdmin=e,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=s1.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&s1.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function f4(s,t,n){let o;if((0,h.vA)("string"==typeof t,"typeof type must == string"),(0,h.vA)("object"==typeof n,"typeof params must == object"),t===p4)o=(s.secure?"wss://":"ws://")+s.internalHost+"/.ws?";else{if(t!==x4)throw new Error("Unknown connection type: "+t);o=(s.secure?"https://":"http://")+s.internalHost+"/.lp?"}(function w6(s){return s.host!==s.internalHost||s.isCustomHost()||s.includeNamespaceInQueryParams})(s)&&(n.ns=s.namespace);const i=[];return O(n,(e,a)=>{i.push(e+"="+a)}),o+i.join("&")}class m6{constructor(){this.counters_={}}incrementCounter(t,n=1){(0,h.gR)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=n}get(){return(0,h.A4)(this.counters_)}}const n0={},s0={};function o0(s){const t=s.toString();return n0[t]||(n0[t]=new m6),n0[t]}class p6{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,n){this.closeAfterResponse=t,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,n){for(this.pendingResponses[t]=n;this.pendingResponses[this.currentResponseNum];){const o=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<o.length;++i)o[i]&&_1(()=>{this.onMessage_(o[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class i1{constructor(t,n,o,i,e,a,l){this.connId=t,this.repoInfo=n,this.applicationId=o,this.appCheckToken=i,this.authToken=e,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=R1(t),this.stats_=o0(n),this.urlFn=c=>(this.appCheckToken&&(c.ac=this.appCheckToken),f4(n,x4,c))}open(t,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new p6(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(s){if((0,h.$g)()||"complete"===document.readyState)s();else{let t=!1;const n=function(){document.body?t||(t=!0,s()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new i0((...e)=>{const[a,l,c,r,v]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===a)this.id=l,this.password=c;else{if("close"!==a)throw new Error("Unrecognized command received: "+a);l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[a,l]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const o={start:"t"};o.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(o.cb=this.scriptTagHolder.uniqueCallbackIdentifier),o.v="5",this.transportSessionId&&(o.s=this.transportSessionId),this.lastSessionId&&(o.ls=this.lastSessionId),this.applicationId&&(o.p=this.applicationId),this.appCheckToken&&(o.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&w4.test(location.hostname)&&(o.r="f");const i=this.urlFn(o);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){i1.forceAllow_=!0}static forceDisallow(){i1.forceDisallow_=!0}static isAvailable(){return!((0,h.$g)()||!i1.forceAllow_&&(i1.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const n=(0,h.As)(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const o=(0,h.KA)(n),i=l4(o,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(t,n){if((0,h.$g)())return;this.myDisconnFrame=document.createElement("iframe");const o={dframe:"t"};o.id=t,o.pw=n,this.myDisconnFrame.src=this.urlFn(o),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const n=(0,h.As)(t).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class i0{constructor(t,n,o,i){if(this.onDisconnect=o,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,h.$g)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=H(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=i0.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(e='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){V("frame writing exception"),l.stack&&V(l.stack),V(l)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||V("No IE domain setting required")}catch{const o=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+o+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,n){for(this.myID=t,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let n=this.urlFn(t),o="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+o.length<=1870;){const a=this.pendingSegs.shift();o=o+"&seg"+i+"="+a.seg+"&ts"+i+"="+a.ts+"&d"+i+"="+a.d,i++}return n+=o,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(t,n,o){this.pendingSegs.push({seg:t,ts:n,d:o}),this.alive&&this.newRequest_()}addLongPollTag_(t,n){this.outstandingRequests.add(n);const o=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(o,Math.floor(25e3));this.addTag(t,()=>{clearTimeout(i),o()})}addTag(t,n){(0,h.$g)()?this.doNodeLongPoll(t,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;const o=this.myIFrame.doc.createElement("script");o.type="text/javascript",o.async=!0,o.src=t,o.onload=o.onreadystatechange=function(){const i=o.readyState;(!i||"loaded"===i||"complete"===i)&&(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),n())},o.onerror=()=>{V("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(o)}catch{}},Math.floor(1))}}let u2=null;typeof MozWebSocket<"u"?u2=MozWebSocket:typeof WebSocket<"u"&&(u2=WebSocket);let C1=(()=>{class s{constructor(n,o,i,e,a,l,c){this.connId=n,this.applicationId=i,this.appCheckToken=e,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=R1(this.connId),this.stats_=o0(o),this.connURL=s.connectionURL_(o,l,c,e,i),this.nodeAdmin=o.nodeAdmin}static connectionURL_(n,o,i,e,a){const l={v:"5"};return!(0,h.$g)()&&typeof location<"u"&&location.hostname&&w4.test(location.hostname)&&(l.r="f"),o&&(l.s=o),i&&(l.ls=i),e&&(l.ac=e),a&&(l.p=a),f4(n,p4,l)}open(n,o){this.onDisconnect=o,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,s1.set("previous_websocket_failure",!0);try{let i;if((0,h.$g)()){i={headers:{"User-Agent":`Firebase/5/${d1}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);const a=process.env,l=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;l&&(i.proxy={origin:l})}this.mySock=new u2(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const e=i.message||i.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const e=i.message||i.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){s.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){const i=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);i&&i.length>1&&parseFloat(i[1])<4.4&&(n=!0)}return!n&&null!==u2&&!s.forceDisallow_}static previouslyFailed(){return s1.isInMemoryStorage||!0===s1.get("previous_websocket_failure")}markConnectionHealthy(){s1.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){const o=this.frames.join("");this.frames=null;const i=(0,h.$L)(o);this.onMessage(i)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if((0,h.vA)(null===this.frames,"We already have a frame buffer"),n.length<=6){const o=Number(n);if(!isNaN(o))return this.handleNewFrameCount_(o),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(null===this.mySock)return;const o=n.data;if(this.bytesReceived+=o.length,this.stats_.incrementCounter("bytes_received",o.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(o);else{const i=this.extractFrameCount_(o);null!==i&&this.appendFrame_(i)}}send(n){this.resetKeepAlive();const o=(0,h.As)(n);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);const i=l4(o,16384);i.length>1&&this.sendString_(String(i.length));for(let e=0;e<i.length;e++)this.sendString_(i[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(n){try{this.mySock.send(n)}catch(o){this.log_("Exception thrown from WebSocket.send():",o.message||o.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return s.responsesRequiredToBeHealthy=2,s.healthyTimeout=3e4,s})(),L4=(()=>{class s{constructor(n){this.initTransports_(n)}static get ALL_TRANSPORTS(){return[i1,C1]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(n){const o=C1&&C1.isAvailable();let i=o&&!C1.previouslyFailed();if(n.webSocketOnly&&(o||j("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[C1];else{const e=this.transports_=[];for(const a of s.ALL_TRANSPORTS)a&&a.isAvailable()&&e.push(a);s.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return s.globalTransportInitialized_=!1,s})();class E4{constructor(t,n,o,i,e,a,l,c,r,v){this.id=t,this.repoInfo_=n,this.applicationId_=o,this.appCheckToken_=i,this.authToken_=e,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=c,this.onKill_=r,this.lastSessionId=v,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=R1("c:"+this.id+":"),this.transportManager_=new L4(n),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),o=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,o)},Math.floor(0));const i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=D1(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return n=>{t===this.conn_?this.onConnectionLost_(n):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return n=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(n):t===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(t){this.sendData_({t:"d",d:t})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const n=t.t;"a"===n?this.upgradeIfSecondaryHealthy_():"r"===n?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===n&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const n=P1("t",t),o=P1("d",t);if("c"===n)this.onSecondaryControl_(o);else{if("d"!==n)throw new Error("Unknown protocol layer: "+n);this.pendingDataMessages.push(o)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const n=P1("t",t),o=P1("d",t);"c"===n?this.onControl_(o):"d"===n&&this.onDataMessage_(o)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const n=P1("t",t);if("d"in t){const o=t.d;if("h"===n){const i=Object.assign({},o);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if("n"===n){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===n?this.onConnectionShutdown_(o):"r"===n?this.onReset_(o):"e"===n?X2("Server Error: "+o):"o"===n?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):X2("Unknown control packet command: "+n)}}onHandshake_(t){const n=t.ts,o=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),"5"!==o&&j("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),o=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,o),D1(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,n){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):D1(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(s1.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class j4{put(t,n,o,i){}merge(t,n,o,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,n,o){}onDisconnectMerge(t,n,o){}onDisconnectCancel(t,n){}reportStats(t){}}class b4{constructor(t){this.allowedEvents_=t,this.listeners_={},(0,h.vA)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const o=[...this.listeners_[t]];for(let i=0;i<o.length;i++)o[i].callback.apply(o[i].context,n)}}on(t,n,o){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:n,context:o});const i=this.getInitialEvent(t);i&&n.apply(o,i)}off(t,n,o){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let e=0;e<i.length;e++)if(i[e].callback===n&&(!o||o===i[e].context))return void i.splice(e,1)}validateEventType_(t){(0,h.vA)(this.allowedEvents_.find(n=>n===t),"Unknown event: "+t)}}class p2 extends b4{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,h.jZ)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new p2}getInitialEvent(t){return(0,h.vA)("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class C{constructor(t,n){if(void 0===n){this.pieces_=t.split("/");let o=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[o]=this.pieces_[i],o++);this.pieces_.length=o,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=n}toString(){let t="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)""!==this.pieces_[n]&&(t+="/"+this.pieces_[n]);return t||"/"}}function z(){return new C("")}function x(s){return s.pieceNum_>=s.pieces_.length?null:s.pieces_[s.pieceNum_]}function e1(s){return s.pieces_.length-s.pieceNum_}function y(s){let t=s.pieceNum_;return t<s.pieces_.length&&t++,new C(s.pieces_,t)}function a0(s){return s.pieceNum_<s.pieces_.length?s.pieces_[s.pieces_.length-1]:null}function q1(s,t=0){return s.pieces_.slice(s.pieceNum_+t)}function N4(s){if(s.pieceNum_>=s.pieces_.length)return null;const t=[];for(let n=s.pieceNum_;n<s.pieces_.length-1;n++)t.push(s.pieces_[n]);return new C(t,0)}function A(s,t){const n=[];for(let o=s.pieceNum_;o<s.pieces_.length;o++)n.push(s.pieces_[o]);if(t instanceof C)for(let o=t.pieceNum_;o<t.pieces_.length;o++)n.push(t.pieces_[o]);else{const o=t.split("/");for(let i=0;i<o.length;i++)o[i].length>0&&n.push(o[i])}return new C(n,0)}function f(s){return s.pieceNum_>=s.pieces_.length}function T(s,t){const n=x(s),o=x(t);if(null===n)return t;if(n===o)return T(y(s),y(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+s+")")}function l0(s,t){if(e1(s)!==e1(t))return!1;for(let n=s.pieceNum_,o=t.pieceNum_;n<=s.pieces_.length;n++,o++)if(s.pieces_[n]!==t.pieces_[o])return!1;return!0}function P(s,t){let n=s.pieceNum_,o=t.pieceNum_;if(e1(s)>e1(t))return!1;for(;n<s.pieces_.length;){if(s.pieces_[n]!==t.pieces_[o])return!1;++n,++o}return!0}class P6{constructor(t,n){this.errorPrefix_=n,this.parts_=q1(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let o=0;o<this.parts_.length;o++)this.byteLength_+=(0,h.OE)(this.parts_[o]);R4(this)}}function R4(s){if(s.byteLength_>768)throw new Error(s.errorPrefix_+"has a key path longer than 768 bytes ("+s.byteLength_+").");if(s.parts_.length>32)throw new Error(s.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+m1(s))}function m1(s){return 0===s.parts_.length?"":"in property '"+s.parts_.join(".")+"'"}class c0 extends b4{constructor(){let t,n;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const o=!document[t];o!==this.visible_&&(this.visible_=o,this.trigger("visible",o))},!1)}static getInstance(){return new c0}getInitialEvent(t){return(0,h.vA)("visible"===t,"Unknown event type: "+t),[this.visible_]}}const U1=1e3;let f2,u1=(()=>{class s extends j4{constructor(n,o,i,e,a,l,c,r){if(super(),this.repoInfo_=n,this.applicationId_=o,this.onDataUpdate_=i,this.onConnectStatus_=e,this.onServerInfoUpdate_=a,this.authTokenProvider_=l,this.appCheckTokenProvider_=c,this.authOverride_=r,this.id=s.nextPersistentConnectionId_++,this.log_=R1("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=U1,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,r&&!(0,h.$g)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");c0.getInstance().on("visible",this.onVisible_,this),-1===n.host.indexOf("fblocal")&&p2.getInstance().on("online",this.onOnline_,this)}sendRequest(n,o,i){const e=++this.requestNumber_,a={r:e,a:n,b:o};this.log_((0,h.As)(a)),(0,h.vA)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),i&&(this.requestCBHash_[e]=i)}get(n){this.initConnection_();const o=new h.cY,e={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:l=>{const c=l.d;"ok"===l.s?o.resolve(c):o.reject(c)}};return this.outstandingGets_.push(e),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),o.promise}listen(n,o,i,e){this.initConnection_();const a=n._queryIdentifier,l=n._path.toString();this.log_("Listen called for "+l+" "+a),this.listens.has(l)||this.listens.set(l,new Map),(0,h.vA)(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,h.vA)(!this.listens.get(l).has(a),"listen() called twice for same path/queryId.");const c={onComplete:e,hashFn:o,query:n,tag:i};this.listens.get(l).set(a,c),this.connected_&&this.sendListen_(c)}sendGet_(n){const o=this.outstandingGets_[n];this.sendRequest("g",o.request,i=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),o.onComplete&&o.onComplete(i)})}sendListen_(n){const o=n.query,i=o._path.toString(),e=o._queryIdentifier;this.log_("Listen on "+i+" for "+e);const a={p:i};n.tag&&(a.q=o._queryObject,a.t=n.tag),a.h=n.hashFn(),this.sendRequest("q",a,c=>{const r=c.d,v=c.s;s.warnOnListenWarnings_(r,o),(this.listens.get(i)&&this.listens.get(i).get(e))===n&&(this.log_("listen response",c),"ok"!==v&&this.removeListen_(i,e),n.onComplete&&n.onComplete(v,r))})}static warnOnListenWarnings_(n,o){if(n&&"object"==typeof n&&(0,h.gR)(n,"w")){const i=(0,h.yw)(n,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const e='".indexOn": "'+o._queryParams.getIndex().toString()+'"',a=o._path.toString();j(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&40===n.length||(0,h.qc)(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_,o=(0,h.Cv)(n)?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(o,i,e=>{const a=e.s,l=e.d||"error";this.authToken_===n&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{const o=n.s,i=n.d||"error";"ok"===o?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(o,i)})}unlisten(n,o){const i=n._path.toString(),e=n._queryIdentifier;this.log_("Unlisten called for "+i+" "+e),(0,h.vA)(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,e)&&this.connected_&&this.sendUnlisten_(i,e,n._queryObject,o)}sendUnlisten_(n,o,i,e){this.log_("Unlisten on "+n+" for "+o);const a={p:n};e&&(a.q=i,a.t=e),this.sendRequest("n",a)}onDisconnectPut(n,o,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,o,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:o,onComplete:i})}onDisconnectMerge(n,o,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,o,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:o,onComplete:i})}onDisconnectCancel(n,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,o):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:o})}sendOnDisconnect_(n,o,i,e){const a={p:o,d:i};this.log_("onDisconnect "+n,a),this.sendRequest(n,a,l=>{e&&setTimeout(()=>{e(l.s,l.d)},Math.floor(0))})}put(n,o,i,e){this.putInternal("p",n,o,i,e)}merge(n,o,i,e){this.putInternal("m",n,o,i,e)}putInternal(n,o,i,e,a){this.initConnection_();const l={p:o,d:i};void 0!==a&&(l.h=a),this.outstandingPuts_.push({action:n,request:l,onComplete:e}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+o)}sendPut_(n){const o=this.outstandingPuts_[n].action,i=this.outstandingPuts_[n].request,e=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(o,i,a=>{this.log_(o+" response",a),delete this.outstandingPuts_[n],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),e&&e(a.s,a.d)})}reportStats(n){if(this.connected_){const o={c:n};this.log_("reportStats",o),this.sendRequest("s",o,i=>{"ok"!==i.s&&this.log_("reportStats","Error sending stats: "+i.d)})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+(0,h.As)(n));const o=n.r,i=this.requestCBHash_[o];i&&(delete this.requestCBHash_[o],i(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,o){this.log_("handleServerMessage",n,o),"d"===n?this.onDataUpdate_(o.p,o.d,!1,o.t):"m"===n?this.onDataUpdate_(o.p,o.d,!0,o.t):"c"===n?this.onListenRevoked_(o.p,o.q):"ac"===n?this.onAuthRevoked_(o.s,o.d):"apc"===n?this.onAppCheckRevoked_(o.s,o.d):"sd"===n?this.onSecurityDebugPacket_(o):X2("Unrecognized action received from server: "+(0,h.As)(n)+"\nAre you using the latest client?")}onReady_(n,o){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(n),this.lastSessionId=o,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){(0,h.vA)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=U1,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=U1,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=U1),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const n=(new Date).getTime()-this.lastConnectionAttemptTime_;let o=Math.max(0,this.reconnectDelay_-n);o=Math.random()*o,this.log_("Trying to reconnect in "+o+"ms"),this.scheduleConnect_(o),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var n=this;return(0,T1.A)(function*(){if(n.shouldReconnect_()){n.log_("Making a connection attempt"),n.lastConnectionAttemptTime_=(new Date).getTime(),n.lastConnectionEstablishedTime_=null;const o=n.onDataMessage_.bind(n),i=n.onReady_.bind(n),e=n.onRealtimeDisconnect_.bind(n),a=n.id+":"+s.nextConnectionId_++,l=n.lastSessionId;let c=!1,r=null;const v=function(){r?r.close():(c=!0,e())};n.realtime_={close:v,sendRequest:function(w){(0,h.vA)(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(w)}};const d=n.forceTokenRefresh_;n.forceTokenRefresh_=!1;try{const[w,u]=yield Promise.all([n.authTokenProvider_.getToken(d),n.appCheckTokenProvider_.getToken(d)]);c?V("getToken() completed but was canceled"):(V("getToken() completed. Creating connection."),n.authToken_=w&&w.accessToken,n.appCheckToken_=u&&u.token,r=new E4(a,n.repoInfo_,n.applicationId_,n.appCheckToken_,n.authToken_,o,i,e,_=>{j(_+" ("+n.repoInfo_.toString()+")"),n.interrupt("server_kill")},l))}catch(w){n.log_("Failed to get token: "+w),c||(n.repoInfo_.nodeAdmin&&j(w),v())}}})()}interrupt(n){V("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){V("Resuming connection for reason: "+n),delete this.interruptReasons_[n],(0,h.Im)(this.interruptReasons_)&&(this.reconnectDelay_=U1,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){const o=n-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:o})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){const o=this.outstandingPuts_[n];o&&"h"in o.request&&o.queued&&(o.onComplete&&o.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(n,o){let i;i=o?o.map(a=>J2(a)).join("$"):"default";const e=this.removeListen_(n,i);e&&e.onComplete&&e.onComplete("permission_denied")}removeListen_(n,o){const i=new C(n).toString();let e;if(this.listens.has(i)){const a=this.listens.get(i);e=a.get(o),a.delete(o),0===a.size&&this.listens.delete(i)}else e=void 0;return e}onAuthRevoked_(n,o){V("Auth token revoked: "+n+"/"+o),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===n||"permission_denied"===n)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,o){V("App check token revoked: "+n+"/"+o),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===n||"permission_denied"===n)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const n of this.listens.values())for(const o of n.values())this.sendListen_(o);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){const n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){const n={};let o="js";(0,h.$g)()&&(o=this.repoInfo_.nodeAdmin?"admin_node":"node"),n["sdk."+o+"."+d1.replace(/\./g,"-")]=1,(0,h.jZ)()?n["framework.cordova"]=1:(0,h.lV)()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){const n=p2.getInstance().currentlyOnline();return(0,h.Im)(this.interruptReasons_)&&n}}return s.nextPersistentConnectionId_=0,s.nextConnectionId_=0,s})();class M{constructor(t,n){this.name=t,this.node=n}static Wrap(t,n){return new M(t,n)}}class x2{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,n){const o=new M(o1,t),i=new M(o1,n);return 0!==this.compare(o,i)}minPost(){return M.MIN}}class F4 extends x2{static get __EMPTY_NODE(){return f2}static set __EMPTY_NODE(t){f2=t}compare(t,n){return w1(t.name,n.name)}isDefinedOn(t){throw(0,h.Hk)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,n){return!1}minPost(){return M.MIN}maxPost(){return new M(t1,f2)}makePost(t,n){return(0,h.vA)("string"==typeof t,"KeyIndex indexValue must always be a string."),new M(t,f2)}toString(){return".key"}}const Q=new F4;class M2{constructor(t,n,o,i,e=null){this.isReverse_=i,this.resultGenerator_=e,this.nodeStack_=[];let a=1;for(;!t.isEmpty();)if(a=n?o(t.key,n):1,i&&(a*=-1),a<0)t=this.isReverse_?t.left:t.right;else{if(0===a){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let n,t=this.nodeStack_.pop();if(n=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}let h0,D=(()=>{class s{constructor(n,o,i,e,a){this.key=n,this.value=o,this.color=null!=i?i:s.RED,this.left=null!=e?e:I.EMPTY_NODE,this.right=null!=a?a:I.EMPTY_NODE}copy(n,o,i,e,a){return new s(null!=n?n:this.key,null!=o?o:this.value,null!=i?i:this.color,null!=e?e:this.left,null!=a?a:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,o,i){let e=this;const a=i(n,e.key);return e=a<0?e.copy(null,null,null,e.left.insert(n,o,i),null):0===a?e.copy(null,o,null,null,null):e.copy(null,null,null,null,e.right.insert(n,o,i)),e.fixUp_()}removeMin_(){if(this.left.isEmpty())return I.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,o){let i,e;if(i=this,o(n,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(n,o),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),0===o(n,i.key)){if(i.right.isEmpty())return I.EMPTY_NODE;e=i.right.min_(),i=i.copy(e.key,e.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(n,o))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){const n=this.copy(null,null,s.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){const n=this.copy(null,null,s.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){const n=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,o)}checkMaxDepth_(){const n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return s.RED=!0,s.BLACK=!1,s})();class I{constructor(t,n=I.EMPTY_NODE){this.comparator_=t,this.root_=n}insert(t,n){return new I(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,D.BLACK,null,null))}remove(t){return new I(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,D.BLACK,null,null))}get(t){let n,o=this.root_;for(;!o.isEmpty();){if(n=this.comparator_(t,o.key),0===n)return o.value;n<0?o=o.left:n>0&&(o=o.right)}return null}getPredecessorKey(t){let n,o=this.root_,i=null;for(;!o.isEmpty();){if(n=this.comparator_(t,o.key),0===n){if(o.left.isEmpty())return i?i.key:null;for(o=o.left;!o.right.isEmpty();)o=o.right;return o.key}n<0?o=o.left:n>0&&(i=o,o=o.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new M2(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,n){return new M2(this.root_,t,this.comparator_,!1,n)}getReverseIteratorFrom(t,n){return new M2(this.root_,t,this.comparator_,!0,n)}getReverseIterator(t){return new M2(this.root_,null,this.comparator_,!0,t)}}function Y6(s,t){return w1(s.name,t.name)}function r0(s,t){return w1(s,t)}I.EMPTY_NODE=new class Q6{copy(t,n,o,i,e){return this}insert(t,n,o){return new D(t,n,null)}remove(t,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const q4=function(s){return"number"==typeof s?"number:"+c4(s):"string:"+s},U4=function(s){if(s.isLeafNode()){const t=s.val();(0,h.vA)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,h.gR)(t,".sv"),"Priority must be a string or number.")}else(0,h.vA)(s===h0||s.isEmpty(),"priority of unexpected type.");(0,h.vA)(s===h0||s.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let W4,G4,Q4,y1=(()=>{class s{constructor(n,o=s.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=o,this.lazyHash_=null,(0,h.vA)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),U4(this.priorityNode_)}static set __childrenNodeConstructor(n){W4=n}static get __childrenNodeConstructor(){return W4}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new s(this.value_,n)}getImmediateChild(n){return".priority"===n?this.priorityNode_:s.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return f(n)?this:".priority"===x(n)?this.priorityNode_:s.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,o){return null}updateImmediateChild(n,o){return".priority"===n?this.updatePriority(o):o.isEmpty()&&".priority"!==n?this:s.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,o).updatePriority(this.priorityNode_)}updateChild(n,o){const i=x(n);return null===i?o:o.isEmpty()&&".priority"!==i?this:((0,h.vA)(".priority"!==i||1===e1(n),".priority must be the last token in a path"),this.updateImmediateChild(i,s.__childrenNodeConstructor.EMPTY_NODE.updateChild(y(n),o)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,o){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+q4(this.priorityNode_.val())+":");const o=typeof this.value_;n+=o+":",n+="number"===o?c4(this.value_):this.value_,this.lazyHash_=b(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===s.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof s.__childrenNodeConstructor?-1:((0,h.vA)(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){const o=typeof n.value_,i=typeof this.value_,e=s.VALUE_TYPE_ORDER.indexOf(o),a=s.VALUE_TYPE_ORDER.indexOf(i);return(0,h.vA)(e>=0,"Unknown leaf type: "+o),(0,h.vA)(a>=0,"Unknown leaf type: "+i),e===a?"object"===i?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:a-e}withIndex(){return this}isIndexed(){return!0}equals(n){return n===this||!!n.isLeafNode()&&(this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_))}}return s.VALUE_TYPE_ORDER=["object","boolean","number","string"],s})();const L=new class J6 extends x2{compare(t,n){const o=t.node.getPriority(),i=n.node.getPriority(),e=o.compareTo(i);return 0===e?w1(t.name,n.name):e}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,n){return!t.getPriority().equals(n.getPriority())}minPost(){return M.MIN}maxPost(){return new M(t1,new y1("[PRIORITY-POST]",Q4))}makePost(t,n){const o=G4(t);return new M(n,new y1("[PRIORITY-POST]",o))}toString(){return".priority"}},Z6=Math.log(2);class t8{constructor(t){this.count=parseInt(Math.log(t+1)/Z6,10),this.current_=this.count-1;const i=(()=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=t+1&i}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const k2=function(s,t,n,o){s.sort(t);const i=function(c,r){const v=r-c;let g,d;if(0===v)return null;if(1===v)return g=s[c],d=n?n(g):g,new D(d,g.node,D.BLACK,null,null);{const w=parseInt(v/2,10)+c,u=i(c,w),_=i(w+1,r);return g=s[w],d=n?n(g):g,new D(d,g.node,D.BLACK,u,_)}},l=function(c){let r=null,v=null,g=s.length;const d=function(u,_){const E=g-u,b1=g;g-=u;const Y2=i(E+1,b1),i4=s[E],wt=n?n(i4):i4;w(new D(wt,i4.node,_,null,Y2))},w=function(u){r?(r.left=u,r=u):(v=u,r=u)};for(let u=0;u<c.count;++u){const _=c.nextBitIsOne(),E=Math.pow(2,c.count-(u+1));_?d(E,D.BLACK):(d(E,D.BLACK),d(E,D.RED))}return v}(new t8(s.length));return new I(o||t,l)};let v0;const L1={};class n1{constructor(t,n){this.indexes_=t,this.indexSet_=n}static get Default(){return(0,h.vA)(L1&&L,"ChildrenNode.ts has not been loaded"),v0=v0||new n1({".priority":L1},{".priority":L}),v0}get(t){const n=(0,h.yw)(this.indexes_,t);if(!n)throw new Error("No index defined for "+t);return n instanceof I?n:null}hasIndex(t){return(0,h.gR)(this.indexSet_,t.toString())}addIndex(t,n){(0,h.vA)(t!==Q,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const o=[];let i=!1;const e=n.getIterator(M.Wrap);let l,a=e.getNext();for(;a;)i=i||t.isDefinedOn(a.node),o.push(a),a=e.getNext();l=i?k2(o,t.getCompare()):L1;const c=t.toString(),r=Object.assign({},this.indexSet_);r[c]=t;const v=Object.assign({},this.indexes_);return v[c]=l,new n1(v,r)}addToIndexes(t,n){const o=(0,h.kH)(this.indexes_,(i,e)=>{const a=(0,h.yw)(this.indexSet_,e);if((0,h.vA)(a,"Missing index implementation for "+e),i===L1){if(a.isDefinedOn(t.node)){const l=[],c=n.getIterator(M.Wrap);let r=c.getNext();for(;r;)r.name!==t.name&&l.push(r),r=c.getNext();return l.push(t),k2(l,a.getCompare())}return L1}{const l=n.get(t.name);let c=i;return l&&(c=c.remove(new M(t.name,l))),c.insert(t,t.node)}});return new n1(o,this.indexSet_)}removeFromIndexes(t,n){const o=(0,h.kH)(this.indexes_,i=>{if(i===L1)return i;{const e=n.get(t.name);return e?i.remove(new M(t.name,e)):i}});return new n1(o,this.indexSet_)}}let W1,p=(()=>{class s{constructor(n,o,i){this.children_=n,this.priorityNode_=o,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&U4(this.priorityNode_),this.children_.isEmpty()&&(0,h.vA)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return W1||(W1=new s(new I(r0),null,n1.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||W1}updatePriority(n){return this.children_.isEmpty()?this:new s(this.children_,n,this.indexMap_)}getImmediateChild(n){if(".priority"===n)return this.getPriority();{const o=this.children_.get(n);return null===o?W1:o}}getChild(n){const o=x(n);return null===o?this:this.getImmediateChild(o).getChild(y(n))}hasChild(n){return null!==this.children_.get(n)}updateImmediateChild(n,o){if((0,h.vA)(o,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(o);{const i=new M(n,o);let e,a;o.isEmpty()?(e=this.children_.remove(n),a=this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,o),a=this.indexMap_.addToIndexes(i,this.children_));const l=e.isEmpty()?W1:this.priorityNode_;return new s(e,l,a)}}updateChild(n,o){const i=x(n);if(null===i)return o;{(0,h.vA)(".priority"!==x(n)||1===e1(n),".priority must be the last token in a path");const e=this.getImmediateChild(i).updateChild(y(n),o);return this.updateImmediateChild(i,e)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const o={};let i=0,e=0,a=!0;if(this.forEachChild(L,(l,c)=>{o[l]=c.val(n),i++,a&&s.INTEGER_REGEXP_.test(l)?e=Math.max(e,Number(l)):a=!1}),!n&&a&&e<2*i){const l=[];for(const c in o)l[c]=o[c];return l}return n&&!this.getPriority().isEmpty()&&(o[".priority"]=this.getPriority().val()),o}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+q4(this.getPriority().val())+":"),this.forEachChild(L,(o,i)=>{const e=i.hash();""!==e&&(n+=":"+o+":"+e)}),this.lazyHash_=""===n?"":b(n)}return this.lazyHash_}getPredecessorChildName(n,o,i){const e=this.resolveIndex_(i);if(e){const a=e.getPredecessorKey(new M(n,o));return a?a.name:null}return this.children_.getPredecessorKey(n)}getFirstChildName(n){const o=this.resolveIndex_(n);if(o){const i=o.minKey();return i&&i.name}return this.children_.minKey()}getFirstChild(n){const o=this.getFirstChildName(n);return o?new M(o,this.children_.get(o)):null}getLastChildName(n){const o=this.resolveIndex_(n);if(o){const i=o.maxKey();return i&&i.name}return this.children_.maxKey()}getLastChild(n){const o=this.getLastChildName(n);return o?new M(o,this.children_.get(o)):null}forEachChild(n,o){const i=this.resolveIndex_(n);return i?i.inorderTraversal(e=>o(e.name,e.node)):this.children_.inorderTraversal(o)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,o){const i=this.resolveIndex_(o);if(i)return i.getIteratorFrom(n,e=>e);{const e=this.children_.getIteratorFrom(n.name,M.Wrap);let a=e.peek();for(;null!=a&&o.compare(a,n)<0;)e.getNext(),a=e.peek();return e}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,o){const i=this.resolveIndex_(o);if(i)return i.getReverseIteratorFrom(n,e=>e);{const e=this.children_.getReverseIteratorFrom(n.name,M.Wrap);let a=e.peek();for(;null!=a&&o.compare(a,n)>0;)e.getNext(),a=e.peek();return e}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===G1?-1:0}withIndex(n){if(n===Q||this.indexMap_.hasIndex(n))return this;{const o=this.indexMap_.addIndex(n,this.children_);return new s(this.children_,this.priorityNode_,o)}}isIndexed(n){return n===Q||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{const o=n;if(this.getPriority().equals(o.getPriority())){if(this.children_.count()===o.children_.count()){const i=this.getIterator(L),e=o.getIterator(L);let a=i.getNext(),l=e.getNext();for(;a&&l;){if(a.name!==l.name||!a.node.equals(l.node))return!1;a=i.getNext(),l=e.getNext()}return null===a&&null===l}return!1}return!1}}resolveIndex_(n){return n===Q?null:this.indexMap_.get(n.toString())}}return s.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,s})();const G1=new class n8 extends p{constructor(){super(new I(r0),p.EMPTY_NODE,n1.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return p.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(M,{MIN:{value:new M(o1,p.EMPTY_NODE)},MAX:{value:new M(t1,G1)}}),F4.__EMPTY_NODE=p.EMPTY_NODE,y1.__childrenNodeConstructor=p,function K6(s){h0=s}(G1),function X6(s){Q4=s}(G1);const s8=!0;function S(s,t=null){if(null===s)return p.EMPTY_NODE;if("object"==typeof s&&".priority"in s&&(t=s[".priority"]),(0,h.vA)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof s&&".value"in s&&null!==s[".value"]&&(s=s[".value"]),"object"!=typeof s||".sv"in s)return new y1(s,S(t));if(s instanceof Array||!s8){let n=p.EMPTY_NODE;return O(s,(o,i)=>{if((0,h.gR)(s,o)&&"."!==o.substring(0,1)){const e=S(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(o,e))}}),n.updatePriority(S(t))}{const n=[];let o=!1;if(O(s,(a,l)=>{if("."!==a.substring(0,1)){const c=S(l);c.isEmpty()||(o=o||!c.getPriority().isEmpty(),n.push(new M(a,c)))}}),0===n.length)return p.EMPTY_NODE;const e=k2(n,Y6,a=>a.name,r0);if(o){const a=k2(n,L.getCompare());return new p(e,S(t),new n1({".priority":a},{".priority":L}))}return new p(e,S(t),n1.Default)}}!function $6(s){G4=s}(S);class g0 extends x2{constructor(t){super(),this.indexPath_=t,(0,h.vA)(!f(t)&&".priority"!==x(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,n){const o=this.extractChild(t.node),i=this.extractChild(n.node),e=o.compareTo(i);return 0===e?w1(t.name,n.name):e}makePost(t,n){const o=S(t),i=p.EMPTY_NODE.updateChild(this.indexPath_,o);return new M(n,i)}maxPost(){const t=p.EMPTY_NODE.updateChild(this.indexPath_,G1);return new M(t1,t)}toString(){return q1(this.indexPath_,0).join("/")}}const d0=new class o8 extends x2{compare(t,n){const o=t.node.compareTo(n.node);return 0===o?w1(t.name,n.name):o}isDefinedOn(t){return!0}indexedValueChanged(t,n){return!t.equals(n)}minPost(){return M.MIN}maxPost(){return M.MAX}makePost(t,n){const o=S(t);return new M(n,o)}toString(){return".value"}};function Y4(s){return{type:"value",snapshotNode:s}}function B1(s,t){return{type:"child_added",snapshotNode:t,childName:s}}function Q1(s,t){return{type:"child_removed",snapshotNode:t,childName:s}}function Y1(s,t,n){return{type:"child_changed",snapshotNode:t,childName:s,oldSnap:n}}class w0{constructor(t){this.index_=t}updateChild(t,n,o,i,e,a){(0,h.vA)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=t.getImmediateChild(n);return l.getChild(i).equals(o.getChild(i))&&l.isEmpty()===o.isEmpty()||(null!=a&&(o.isEmpty()?t.hasChild(n)?a.trackChildChange(Q1(n,l)):(0,h.vA)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(B1(n,o)):a.trackChildChange(Y1(n,o,l))),t.isLeafNode()&&o.isEmpty())?t:t.updateImmediateChild(n,o).withIndex(this.index_)}updateFullNode(t,n,o){return null!=o&&(t.isLeafNode()||t.forEachChild(L,(i,e)=>{n.hasChild(i)||o.trackChildChange(Q1(i,e))}),n.isLeafNode()||n.forEachChild(L,(i,e)=>{if(t.hasChild(i)){const a=t.getImmediateChild(i);a.equals(e)||o.trackChildChange(Y1(i,e,a))}else o.trackChildChange(B1(i,e))})),n.withIndex(this.index_)}updatePriority(t,n){return t.isEmpty()?p.EMPTY_NODE:t.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class K1{constructor(t){this.indexedFilter_=new w0(t.getIndex()),this.index_=t.getIndex(),this.startPost_=K1.getStartPost_(t),this.endPost_=K1.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,o=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return n&&o}updateChild(t,n,o,i,e,a){return this.matches(new M(n,o))||(o=p.EMPTY_NODE),this.indexedFilter_.updateChild(t,n,o,i,e,a)}updateFullNode(t,n,o){n.isLeafNode()&&(n=p.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(p.EMPTY_NODE);const e=this;return n.forEachChild(L,(a,l)=>{e.matches(new M(a,l))||(i=i.updateImmediateChild(a,p.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,i,o)}updatePriority(t,n){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const n=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),n)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const n=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),n)}return t.getIndex().maxPost()}}class e8{constructor(t){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const o=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?o<=0:o<0},this.withinEndPost=n=>{const o=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?o<=0:o<0},this.rangedFilter_=new K1(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,n,o,i,e,a){return this.rangedFilter_.matches(new M(n,o))||(o=p.EMPTY_NODE),t.getImmediateChild(n).equals(o)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,n,o,i,e,a):this.fullLimitUpdateChild_(t,n,o,e,a)}updateFullNode(t,n,o){let i;if(n.isLeafNode()||n.isEmpty())i=p.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<n.numChildren()&&n.isIndexed(this.index_)){let e;i=p.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;e.hasNext()&&a<this.limit_;){const l=e.getNext();if(this.withinDirectionalStart(l)){if(!this.withinDirectionalEnd(l))break;i=i.updateImmediateChild(l.name,l.node),a++}}}else{let e;i=n.withIndex(this.index_),i=i.updatePriority(p.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let a=0;for(;e.hasNext();){const l=e.getNext();a<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?a++:i=i.updateImmediateChild(l.name,p.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,i,o)}updatePriority(t,n){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,n,o,i,e){let a;if(this.reverse_){const g=this.index_.getCompare();a=(d,w)=>g(w,d)}else a=this.index_.getCompare();const l=t;(0,h.vA)(l.numChildren()===this.limit_,"");const c=new M(n,o),r=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),v=this.rangedFilter_.matches(c);if(l.hasChild(n)){const g=l.getImmediateChild(n);let d=i.getChildAfterChild(this.index_,r,this.reverse_);for(;null!=d&&(d.name===n||l.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);const w=null==d?1:a(d,c);if(v&&!o.isEmpty()&&w>=0)return null!=e&&e.trackChildChange(Y1(n,o,g)),l.updateImmediateChild(n,o);{null!=e&&e.trackChildChange(Q1(n,g));const _=l.updateImmediateChild(n,p.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=e&&e.trackChildChange(B1(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}return o.isEmpty()?t:v&&a(r,c)>=0?(null!=e&&(e.trackChildChange(Q1(r.name,r.node)),e.trackChildChange(B1(n,o))),l.updateImmediateChild(n,o).updateImmediateChild(r.name,p.EMPTY_NODE)):t}}class m0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=L}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,h.vA)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,h.vA)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:o1}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,h.vA)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,h.vA)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:t1}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,h.vA)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===L}copy(){const t=new m0;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function K4(s){const t={};if(s.isDefault())return t;let n;if(s.index_===L?n="$priority":s.index_===d0?n="$value":s.index_===Q?n="$key":((0,h.vA)(s.index_ instanceof g0,"Unrecognized index type!"),n=s.index_.toString()),t.orderBy=(0,h.As)(n),s.startSet_){const o=s.startAfterSet_?"startAfter":"startAt";t[o]=(0,h.As)(s.indexStartValue_),s.startNameSet_&&(t[o]+=","+(0,h.As)(s.indexStartName_))}if(s.endSet_){const o=s.endBeforeSet_?"endBefore":"endAt";t[o]=(0,h.As)(s.indexEndValue_),s.endNameSet_&&(t[o]+=","+(0,h.As)(s.indexEndName_))}return s.limitSet_&&(s.isViewFromLeft()?t.limitToFirst=s.limit_:t.limitToLast=s.limit_),t}function $4(s){const t={};if(s.startSet_&&(t.sp=s.indexStartValue_,s.startNameSet_&&(t.sn=s.indexStartName_),t.sin=!s.startAfterSet_),s.endSet_&&(t.ep=s.indexEndValue_,s.endNameSet_&&(t.en=s.indexEndName_),t.ein=!s.endBeforeSet_),s.limitSet_){t.l=s.limit_;let n=s.viewFrom_;""===n&&(n=s.isViewFromLeft()?"l":"r"),t.vf=n}return s.index_!==L&&(t.i=s.index_.toString()),t}class _2 extends j4{constructor(t,n,o,i){super(),this.repoInfo_=t,this.onDataUpdate_=n,this.authTokenProvider_=o,this.appCheckTokenProvider_=i,this.log_=R1("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,n){return void 0!==n?"tag$"+n:((0,h.vA)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,n,o,i){const e=t._path.toString();this.log_("Listen called for "+e+" "+t._queryIdentifier);const a=_2.getListenId_(t,o),l={};this.listens_[a]=l;const c=K4(t._queryParams);this.restRequest_(e+".json",c,(r,v)=>{let g=v;if(404===r&&(g=null,r=null),null===r&&this.onDataUpdate_(e,g,!1,o),(0,h.yw)(this.listens_,a)===l){let d;d=r?401===r?"permission_denied":"rest_error:"+r:"ok",i(d,null)}})}unlisten(t,n){const o=_2.getListenId_(t,n);delete this.listens_[o]}get(t){const n=K4(t._queryParams),o=t._path.toString(),i=new h.cY;return this.restRequest_(o+".json",n,(e,a)=>{let l=a;404===e&&(l=null,e=null),null===e?(this.onDataUpdate_(o,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(t){}restRequest_(t,n={},o){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,e])=>{i&&i.accessToken&&(n.auth=i.accessToken),e&&e.token&&(n.ac=e.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+(0,h.Am)(n);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(o&&4===l.readyState){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=(0,h.$L)(l.responseText)}catch{j("Failed to parse JSON response for "+a+": "+l.responseText)}o(null,c)}else 401!==l.status&&404!==l.status&&j("Got unsuccessful REST response for "+a+" Status: "+l.status),o(l.status);o=null}},l.open("GET",a,!0),l.send()})}}class v8{constructor(){this.rootNode_=p.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,n){this.rootNode_=this.rootNode_.updateChild(t,n)}}function C2(){return{value:null,children:new Map}}function A1(s,t,n){if(f(t))s.value=n,s.children.clear();else if(null!==s.value)s.value=s.value.updateChild(t,n);else{const o=x(t);s.children.has(o)||s.children.set(o,C2()),A1(s.children.get(o),t=y(t),n)}}function f0(s,t,n){null!==s.value?n(t,s.value):function g8(s,t){s.children.forEach((n,o)=>{t(o,n)})}(s,(o,i)=>{f0(i,new C(t.toString()+"/"+o),n)})}class d8{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),n=Object.assign({},t);return this.last_&&O(this.last_,(o,i)=>{n[o]=n[o]-i}),this.last_=t,n}}class u8{constructor(t,n){this.server_=n,this.statsToReport_={},this.statsListener_=new d8(t);const o=1e4+2e4*Math.random();D1(this.reportStats_.bind(this),Math.floor(o))}reportStats_(){const t=this.statsListener_.get(),n={};let o=!1;O(t,(i,e)=>{e>0&&(0,h.gR)(this.statsToReport_,i)&&(n[i]=e,o=!0)}),o&&this.server_.reportStats(n),D1(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Y=function(s){return s[s.OVERWRITE=0]="OVERWRITE",s[s.MERGE=1]="MERGE",s[s.ACK_USER_WRITE=2]="ACK_USER_WRITE",s[s.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",s}(Y||{});function z0(s){return{fromUser:!1,fromServer:!0,queryId:s,tagged:!0}}class y2{constructor(t,n,o){this.path=t,this.affectedTree=n,this.revert=o,this.type=Y.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(f(this.path)){if(null!=this.affectedTree.value)return(0,h.vA)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new C(t));return new y2(z(),n,this.revert)}}return(0,h.vA)(x(this.path)===t,"operationForChild called for unrelated child."),new y2(y(this.path),this.affectedTree,this.revert)}}class $1{constructor(t,n){this.source=t,this.path=n,this.type=Y.LISTEN_COMPLETE}operationForChild(t){return f(this.path)?new $1(this.source,z()):new $1(this.source,y(this.path))}}class p1{constructor(t,n,o){this.source=t,this.path=n,this.snap=o,this.type=Y.OVERWRITE}operationForChild(t){return f(this.path)?new p1(this.source,z(),this.snap.getImmediateChild(t)):new p1(this.source,y(this.path),this.snap)}}class S1{constructor(t,n,o){this.source=t,this.path=n,this.children=o,this.type=Y.MERGE}operationForChild(t){if(f(this.path)){const n=this.children.subtree(new C(t));return n.isEmpty()?null:n.value?new p1(this.source,z(),n.value):new S1(this.source,z(),n)}return(0,h.vA)(x(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new S1(this.source,y(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class a1{constructor(t,n,o){this.node_=t,this.fullyInitialized_=n,this.filtered_=o}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(f(t))return this.isFullyInitialized()&&!this.filtered_;const n=x(t);return this.isCompleteForChild(n)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class p8{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function X1(s,t,n,o,i,e){const a=o.filter(l=>l.type===n);a.sort((l,c)=>function M8(s,t,n){if(null==t.childName||null==n.childName)throw(0,h.Hk)("Should only compare child_ events.");const o=new M(t.childName,t.snapshotNode),i=new M(n.childName,n.snapshotNode);return s.index_.compare(o,i)}(s,l,c)),a.forEach(l=>{const c=function f8(s,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,s.index_)),t}(s,l,e);i.forEach(r=>{r.respondsTo(l.type)&&t.push(r.createEvent(c,s.query_))})})}function L2(s,t){return{eventCache:s,serverCache:t}}function J1(s,t,n,o){return L2(new a1(t,n,o),s.serverCache)}function J4(s,t,n,o){return L2(s.eventCache,new a1(t,n,o))}function B2(s){return s.eventCache.isFullyInitialized()?s.eventCache.getNode():null}function x1(s){return s.serverCache.isFullyInitialized()?s.serverCache.getNode():null}let _0;class B{constructor(t,n=(()=>(_0||(_0=new I(i6)),_0))()){this.value=t,this.children=n}static fromObject(t){let n=new B(null);return O(t,(o,i)=>{n=n.set(new C(o),i)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,n){if(null!=this.value&&n(this.value))return{path:z(),value:this.value};if(f(t))return null;{const o=x(t),i=this.children.get(o);if(null!==i){const e=i.findRootMostMatchingPathAndValue(y(t),n);return null!=e?{path:A(new C(o),e.path),value:e.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(f(t))return this;{const n=x(t),o=this.children.get(n);return null!==o?o.subtree(y(t)):new B(null)}}set(t,n){if(f(t))return new B(n,this.children);{const o=x(t),e=(this.children.get(o)||new B(null)).set(y(t),n),a=this.children.insert(o,e);return new B(this.value,a)}}remove(t){if(f(t))return this.children.isEmpty()?new B(null):new B(null,this.children);{const n=x(t),o=this.children.get(n);if(o){const i=o.remove(y(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new B(null):new B(this.value,e)}return this}}get(t){if(f(t))return this.value;{const n=x(t),o=this.children.get(n);return o?o.get(y(t)):null}}setTree(t,n){if(f(t))return n;{const o=x(t),e=(this.children.get(o)||new B(null)).setTree(y(t),n);let a;return a=e.isEmpty()?this.children.remove(o):this.children.insert(o,e),new B(this.value,a)}}fold(t){return this.fold_(z(),t)}fold_(t,n){const o={};return this.children.inorderTraversal((i,e)=>{o[i]=e.fold_(A(t,i),n)}),n(t,this.value,o)}findOnPath(t,n){return this.findOnPath_(t,z(),n)}findOnPath_(t,n,o){const i=!!this.value&&o(n,this.value);if(i)return i;if(f(t))return null;{const e=x(t),a=this.children.get(e);return a?a.findOnPath_(y(t),A(n,e),o):null}}foreachOnPath(t,n){return this.foreachOnPath_(t,z(),n)}foreachOnPath_(t,n,o){if(f(t))return this;{this.value&&o(n,this.value);const i=x(t),e=this.children.get(i);return e?e.foreachOnPath_(y(t),A(n,i),o):new B(null)}}foreach(t){this.foreach_(z(),t)}foreach_(t,n){this.children.inorderTraversal((o,i)=>{i.foreach_(A(t,o),n)}),this.value&&n(t,this.value)}foreachChild(t){this.children.inorderTraversal((n,o)=>{o.value&&t(n,o.value)})}}class F{constructor(t){this.writeTree_=t}static empty(){return new F(new B(null))}}function Z1(s,t,n){if(f(t))return new F(new B(n));{const o=s.writeTree_.findRootMostValueAndPath(t);if(null!=o){const i=o.path;let e=o.value;const a=T(i,t);return e=e.updateChild(a,n),new F(s.writeTree_.set(i,e))}{const i=new B(n),e=s.writeTree_.setTree(t,i);return new F(e)}}}function C0(s,t,n){let o=s;return O(n,(i,e)=>{o=Z1(o,A(t,i),e)}),o}function Z4(s,t){if(f(t))return F.empty();{const n=s.writeTree_.setTree(t,new B(null));return new F(n)}}function y0(s,t){return null!=f1(s,t)}function f1(s,t){const n=s.writeTree_.findRootMostValueAndPath(t);return null!=n?s.writeTree_.get(n.path).getChild(T(n.path,t)):null}function t3(s){const t=[],n=s.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(L,(o,i)=>{t.push(new M(o,i))}):s.writeTree_.children.inorderTraversal((o,i)=>{null!=i.value&&t.push(new M(o,i.value))}),t}function l1(s,t){if(f(t))return s;{const n=f1(s,t);return new F(null!=n?new B(n):s.writeTree_.subtree(t))}}function L0(s){return s.writeTree_.isEmpty()}function H1(s,t){return n3(z(),s.writeTree_,t)}function n3(s,t,n){if(null!=t.value)return n.updateChild(s,t.value);{let o=null;return t.children.inorderTraversal((i,e)=>{".priority"===i?((0,h.vA)(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):n=n3(A(s,i),e,n)}),!n.getChild(s).isEmpty()&&null!==o&&(n=n.updateChild(A(s,".priority"),o)),n}}function A2(s,t){return l3(t,s)}function y8(s,t){if(s.snap)return P(s.path,t);for(const n in s.children)if(s.children.hasOwnProperty(n)&&P(A(s.path,n),t))return!0;return!1}function B8(s){return s.visible}function o3(s,t,n){let o=F.empty();for(let i=0;i<s.length;++i){const e=s[i];if(t(e)){const a=e.path;let l;if(e.snap)P(n,a)?(l=T(n,a),o=Z1(o,l,e.snap)):P(a,n)&&(l=T(a,n),o=Z1(o,z(),e.snap.getChild(l)));else{if(!e.children)throw(0,h.Hk)("WriteRecord should have .snap or .children");if(P(n,a))l=T(n,a),o=C0(o,l,e.children);else if(P(a,n))if(l=T(a,n),f(l))o=C0(o,z(),e.children);else{const c=(0,h.yw)(e.children,x(l));if(c){const r=c.getChild(y(l));o=Z1(o,z(),r)}}}}}return o}function i3(s,t,n,o,i){if(o||i){const e=l1(s.visibleWrites,t);return!i&&L0(e)?n:i||null!=n||y0(e,z())?H1(o3(s.allWrites,function(r){return(r.visible||i)&&(!o||!~o.indexOf(r.writeId))&&(P(r.path,t)||P(t,r.path))},t),n||p.EMPTY_NODE):null}{const e=f1(s.visibleWrites,t);if(null!=e)return e;{const a=l1(s.visibleWrites,t);return L0(a)?n:null!=n||y0(a,z())?H1(a,n||p.EMPTY_NODE):null}}}function S2(s,t,n,o){return i3(s.writeTree,s.treePath,t,n,o)}function B0(s,t){return function A8(s,t,n){let o=p.EMPTY_NODE;const i=f1(s.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(L,(e,a)=>{o=o.updateImmediateChild(e,a)}),o;if(n){const e=l1(s.visibleWrites,t);return n.forEachChild(L,(a,l)=>{const c=H1(l1(e,new C(a)),l);o=o.updateImmediateChild(a,c)}),t3(e).forEach(a=>{o=o.updateImmediateChild(a.name,a.node)}),o}return t3(l1(s.visibleWrites,t)).forEach(a=>{o=o.updateImmediateChild(a.name,a.node)}),o}(s.writeTree,s.treePath,t)}function e3(s,t,n,o){return function S8(s,t,n,o,i){(0,h.vA)(o||i,"Either existingEventSnap or existingServerSnap must exist");const e=A(t,n);if(y0(s.visibleWrites,e))return null;{const a=l1(s.visibleWrites,e);return L0(a)?i.getChild(n):H1(a,i.getChild(n))}}(s.writeTree,s.treePath,t,n,o)}function H2(s,t){return function V8(s,t){return f1(s.visibleWrites,t)}(s.writeTree,A(s.treePath,t))}function A0(s,t,n){return function H8(s,t,n,o){const i=A(t,n),e=f1(s.visibleWrites,i);return null!=e?e:o.isCompleteForChild(n)?H1(l1(s.visibleWrites,i),o.getNode().getImmediateChild(n)):null}(s.writeTree,s.treePath,t,n)}function a3(s,t){return l3(A(s.treePath,t),s.writeTree)}function l3(s,t){return{treePath:s,writeTree:t}}class b8{constructor(){this.changeMap=new Map}trackChildChange(t){const n=t.type,o=t.childName;(0,h.vA)("child_added"===n||"child_changed"===n||"child_removed"===n,"Only child changes supported for tracking"),(0,h.vA)(".priority"!==o,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(o);if(i){const e=i.type;if("child_added"===n&&"child_removed"===e)this.changeMap.set(o,Y1(o,t.snapshotNode,i.snapshotNode));else if("child_removed"===n&&"child_added"===e)this.changeMap.delete(o);else if("child_removed"===n&&"child_changed"===e)this.changeMap.set(o,Q1(o,i.oldSnap));else if("child_changed"===n&&"child_added"===e)this.changeMap.set(o,B1(o,t.snapshotNode));else{if("child_changed"!==n||"child_changed"!==e)throw(0,h.Hk)("Illegal combination of changes: "+t+" occurred after "+i);this.changeMap.set(o,Y1(o,t.snapshotNode,i.oldSnap))}}else this.changeMap.set(o,t)}getChanges(){return Array.from(this.changeMap.values())}}const c3=new class T8{getCompleteChild(t){return null}getChildAfterChild(t,n,o){return null}};class S0{constructor(t,n,o=null){this.writes_=t,this.viewCache_=n,this.optCompleteServerCache_=o}getCompleteChild(t){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(t))return n.getNode().getImmediateChild(t);{const o=null!=this.optCompleteServerCache_?new a1(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return A0(this.writes_,t,o)}}getChildAfterChild(t,n,o){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:x1(this.viewCache_),e=function j8(s,t,n,o,i,e){return function O8(s,t,n,o,i,e,a){let l;const c=l1(s.visibleWrites,t),r=f1(c,z());if(null!=r)l=r;else{if(null==n)return[];l=H1(c,n)}if(l=l.withIndex(a),l.isEmpty()||l.isLeafNode())return[];{const v=[],g=a.getCompare(),d=e?l.getReverseIteratorFrom(o,a):l.getIteratorFrom(o,a);let w=d.getNext();for(;w&&v.length<i;)0!==g(w,o)&&v.push(w),w=d.getNext();return v}}(s.writeTree,s.treePath,t,n,o,i,e)}(this.writes_,i,n,1,o,t);return 0===e.length?null:e[0]}}function r3(s,t,n,o,i,e){const a=t.eventCache;if(null!=H2(o,n))return t;{let l,c;if(f(n))if((0,h.vA)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const r=x1(t),g=B0(o,r instanceof p?r:p.EMPTY_NODE);l=s.filter.updateFullNode(t.eventCache.getNode(),g,e)}else{const r=S2(o,x1(t));l=s.filter.updateFullNode(t.eventCache.getNode(),r,e)}else{const r=x(n);if(".priority"===r){(0,h.vA)(1===e1(n),"Can't have a priority with additional path components");const v=a.getNode();c=t.serverCache.getNode();const g=e3(o,n,v,c);l=null!=g?s.filter.updatePriority(v,g):a.getNode()}else{const v=y(n);let g;if(a.isCompleteForChild(r)){c=t.serverCache.getNode();const d=e3(o,n,a.getNode(),c);g=null!=d?a.getNode().getImmediateChild(r).updateChild(v,d):a.getNode().getImmediateChild(r)}else g=A0(o,r,t.serverCache);l=null!=g?s.filter.updateChild(a.getNode(),r,g,v,i,e):a.getNode()}}return J1(t,l,a.isFullyInitialized()||f(n),s.filter.filtersNodes())}}function V2(s,t,n,o,i,e,a,l){const c=t.serverCache;let r;const v=a?s.filter:s.filter.getIndexedFilter();if(f(n))r=v.updateFullNode(c.getNode(),o,null);else if(v.filtersNodes()&&!c.isFiltered()){const w=c.getNode().updateChild(n,o);r=v.updateFullNode(c.getNode(),w,null)}else{const w=x(n);if(!c.isCompleteForPath(n)&&e1(n)>1)return t;const u=y(n),E=c.getNode().getImmediateChild(w).updateChild(u,o);r=".priority"===w?v.updatePriority(c.getNode(),E):v.updateChild(c.getNode(),w,E,u,c3,null)}const g=J4(t,r,c.isFullyInitialized()||f(n),v.filtersNodes());return r3(s,g,n,i,new S0(i,g,e),l)}function H0(s,t,n,o,i,e,a){const l=t.eventCache;let c,r;const v=new S0(i,t,e);if(f(n))r=s.filter.updateFullNode(t.eventCache.getNode(),o,a),c=J1(t,r,!0,s.filter.filtersNodes());else{const g=x(n);if(".priority"===g)r=s.filter.updatePriority(t.eventCache.getNode(),o),c=J1(t,r,l.isFullyInitialized(),l.isFiltered());else{const d=y(n),w=l.getNode().getImmediateChild(g);let u;if(f(d))u=o;else{const _=v.getCompleteChild(g);u=null!=_?".priority"===a0(d)&&_.getChild(N4(d)).isEmpty()?_:_.updateChild(d,o):p.EMPTY_NODE}c=w.equals(u)?t:J1(t,s.filter.updateChild(l.getNode(),g,u,d,v,a),l.isFullyInitialized(),s.filter.filtersNodes())}}return c}function h3(s,t){return s.eventCache.isCompleteForChild(t)}function v3(s,t,n){return n.foreach((o,i)=>{t=t.updateChild(o,i)}),t}function V0(s,t,n,o,i,e,a,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let r,c=t;r=f(n)?o:new B(null).setTree(n,o);const v=t.serverCache.getNode();return r.children.inorderTraversal((g,d)=>{if(v.hasChild(g)){const u=v3(0,t.serverCache.getNode().getImmediateChild(g),d);c=V2(s,c,new C(g),u,i,e,a,l)}}),r.children.inorderTraversal((g,d)=>{const w=!t.serverCache.isCompleteForChild(g)&&null===d.value;if(!v.hasChild(g)&&!w){const _=v3(0,t.serverCache.getNode().getImmediateChild(g),d);c=V2(s,c,new C(g),_,i,e,a,l)}}),c}class W8{constructor(t,n){this.query_=t,this.eventRegistrations_=[];const o=this.query_._queryParams,i=new w0(o.getIndex()),e=function a8(s){return s.loadsAllData()?new w0(s.getIndex()):s.hasLimit()?new e8(s):new K1(s)}(o);this.processor_=function I8(s){return{filter:s}}(e);const a=n.serverCache,l=n.eventCache,c=i.updateFullNode(p.EMPTY_NODE,a.getNode(),null),r=e.updateFullNode(p.EMPTY_NODE,l.getNode(),null),v=new a1(c,a.isFullyInitialized(),i.filtersNodes()),g=new a1(r,l.isFullyInitialized(),e.filtersNodes());this.viewCache_=L2(g,v),this.eventGenerator_=new p8(this.query_)}get query(){return this.query_}}function Y8(s,t){const n=x1(s.viewCache_);return n&&(s.query._queryParams.loadsAllData()||!f(t)&&!n.getImmediateChild(x(t)).isEmpty())?n.getChild(t):null}function g3(s){return 0===s.eventRegistrations_.length}function d3(s,t,n){const o=[];if(n){(0,h.vA)(null==t,"A cancel should cancel all event registrations.");const i=s.query._path;s.eventRegistrations_.forEach(e=>{const a=e.createCancelEvent(n,i);a&&o.push(a)})}if(t){let i=[];for(let e=0;e<s.eventRegistrations_.length;++e){const a=s.eventRegistrations_[e];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(s.eventRegistrations_.slice(e+1));break}}else i.push(a)}s.eventRegistrations_=i}else s.eventRegistrations_=[];return o}function w3(s,t,n,o){t.type===Y.MERGE&&null!==t.source.queryId&&((0,h.vA)(x1(s.viewCache_),"We should always have a full cache before handling merges"),(0,h.vA)(B2(s.viewCache_),"Missing event cache, even though we have a server cache"));const i=s.viewCache_,e=function R8(s,t,n,o,i){const e=new b8;let a,l;if(n.type===Y.OVERWRITE){const r=n;r.source.fromUser?a=H0(s,t,r.path,r.snap,o,i,e):((0,h.vA)(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered()&&!f(r.path),a=V2(s,t,r.path,r.snap,o,i,l,e))}else if(n.type===Y.MERGE){const r=n;r.source.fromUser?a=function D8(s,t,n,o,i,e,a){let l=t;return o.foreach((c,r)=>{const v=A(n,c);h3(t,x(v))&&(l=H0(s,l,v,r,i,e,a))}),o.foreach((c,r)=>{const v=A(n,c);h3(t,x(v))||(l=H0(s,l,v,r,i,e,a))}),l}(s,t,r.path,r.children,o,i,e):((0,h.vA)(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered(),a=V0(s,t,r.path,r.children,o,i,l,e))}else if(n.type===Y.ACK_USER_WRITE){const r=n;a=r.revert?function U8(s,t,n,o,i,e){let a;if(null!=H2(o,n))return t;{const l=new S0(o,t,i),c=t.eventCache.getNode();let r;if(f(n)||".priority"===x(n)){let v;if(t.serverCache.isFullyInitialized())v=S2(o,x1(t));else{const g=t.serverCache.getNode();(0,h.vA)(g instanceof p,"serverChildren would be complete if leaf node"),v=B0(o,g)}r=s.filter.updateFullNode(c,v,e)}else{const v=x(n);let g=A0(o,v,t.serverCache);null==g&&t.serverCache.isCompleteForChild(v)&&(g=c.getImmediateChild(v)),r=null!=g?s.filter.updateChild(c,v,g,y(n),l,e):t.eventCache.getNode().hasChild(v)?s.filter.updateChild(c,v,p.EMPTY_NODE,y(n),l,e):c,r.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=S2(o,x1(t)),a.isLeafNode()&&(r=s.filter.updateFullNode(r,a,e)))}return a=t.serverCache.isFullyInitialized()||null!=H2(o,z()),J1(t,r,a,s.filter.filtersNodes())}}(s,t,r.path,o,i,e):function F8(s,t,n,o,i,e,a){if(null!=H2(i,n))return t;const l=t.serverCache.isFiltered(),c=t.serverCache;if(null!=o.value){if(f(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return V2(s,t,n,c.getNode().getChild(n),i,e,l,a);if(f(n)){let r=new B(null);return c.getNode().forEachChild(Q,(v,g)=>{r=r.set(new C(v),g)}),V0(s,t,n,r,i,e,l,a)}return t}{let r=new B(null);return o.foreach((v,g)=>{const d=A(n,v);c.isCompleteForPath(d)&&(r=r.set(v,c.getNode().getChild(d)))}),V0(s,t,n,r,i,e,l,a)}}(s,t,r.path,r.affectedTree,o,i,e)}else{if(n.type!==Y.LISTEN_COMPLETE)throw(0,h.Hk)("Unknown operation type: "+n.type);a=function q8(s,t,n,o,i){const e=t.serverCache;return r3(s,J4(t,e.getNode(),e.isFullyInitialized()||f(n),e.isFiltered()),n,o,c3,i)}(s,t,n.path,o,e)}const c=e.getChanges();return function P8(s,t,n){const o=t.eventCache;if(o.isFullyInitialized()){const i=o.getNode().isLeafNode()||o.getNode().isEmpty(),e=B2(s);(n.length>0||!s.eventCache.isFullyInitialized()||i&&!o.getNode().equals(e)||!o.getNode().getPriority().equals(e.getPriority()))&&n.push(Y4(B2(t)))}}(t,a,c),{viewCache:a,changes:c}}(s.processor_,i,t,n,o);return function N8(s,t){(0,h.vA)(t.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),(0,h.vA)(t.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed")}(s.processor_,e.viewCache),(0,h.vA)(e.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),s.viewCache_=e.viewCache,m3(s,e.changes,e.viewCache.eventCache.getNode(),null)}function m3(s,t,n,o){return function x8(s,t,n,o){const i=[],e=[];return t.forEach(a=>{"child_changed"===a.type&&s.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&e.push(function i8(s,t){return{type:"child_moved",snapshotNode:t,childName:s}}(a.childName,a.snapshotNode))}),X1(s,i,"child_removed",t,o,n),X1(s,i,"child_added",t,o,n),X1(s,i,"child_moved",e,o,n),X1(s,i,"child_changed",t,o,n),X1(s,i,"value",t,o,n),i}(s.eventGenerator_,t,n,o?[o]:s.eventRegistrations_)}let O2,j2;class u3{constructor(){this.views=new Map}}function O0(s,t,n,o){const i=t.source.queryId;if(null!==i){const e=s.views.get(i);return(0,h.vA)(null!=e,"SyncTree gave us an op for an invalid query."),w3(e,t,n,o)}{let e=[];for(const a of s.views.values())e=e.concat(w3(a,t,n,o));return e}}function t5(s,t,n,o,i,e){const a=function p3(s,t,n,o,i){const a=s.views.get(t._queryIdentifier);if(!a){let l=S2(n,i?o:null),c=!1;l?c=!0:o instanceof p?(l=B0(n,o),c=!1):(l=p.EMPTY_NODE,c=!1);const r=L2(new a1(l,c,!1),new a1(o,i,!1));return new W8(t,r)}return a}(s,t,o,i,e);return s.views.has(t._queryIdentifier)||s.views.set(t._queryIdentifier,a),function K8(s,t){s.eventRegistrations_.push(t)}(a,n),function $8(s,t){const n=s.viewCache_.eventCache,o=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(L,(e,a)=>{o.push(B1(e,a))}),n.isFullyInitialized()&&o.push(Y4(n.getNode())),m3(s,o,n.getNode(),t)}(a,n)}function x3(s){const t=[];for(const n of s.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function c1(s,t){let n=null;for(const o of s.views.values())n=n||Y8(o,t);return n}function f3(s,t){return t._queryParams.loadsAllData()?E2(s):s.views.get(t._queryIdentifier)}function M3(s,t){return null!=f3(s,t)}function r1(s){return null!=E2(s)}function E2(s){for(const t of s.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let i5=1;class k3{constructor(t){this.listenProvider_=t,this.syncPointTree_=new B(null),this.pendingWriteTree_=function E8(){return{visibleWrites:F.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function E0(s,t,n,o,i){return function z8(s,t,n,o,i){(0,h.vA)(o>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),s.allWrites.push({path:t,snap:n,writeId:o,visible:i}),i&&(s.visibleWrites=Z1(s.visibleWrites,t,n)),s.lastWriteId=o}(s.pendingWriteTree_,t,n,o,i),i?V1(s,new p1({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function h1(s,t,n=!1){const o=function s3(s,t){for(let n=0;n<s.allWrites.length;n++){const o=s.allWrites[n];if(o.writeId===t)return o}return null}(s.pendingWriteTree_,t);if(function C8(s,t){const n=s.allWrites.findIndex(l=>l.writeId===t);(0,h.vA)(n>=0,"removeWrite called with nonexistent writeId.");const o=s.allWrites[n];s.allWrites.splice(n,1);let i=o.visible,e=!1,a=s.allWrites.length-1;for(;i&&a>=0;){const l=s.allWrites[a];l.visible&&(a>=n&&y8(l,o.path)?i=!1:P(o.path,l.path)&&(e=!0)),a--}return!!i&&(e?(function L8(s){s.visibleWrites=o3(s.allWrites,B8,z()),s.lastWriteId=s.allWrites.length>0?s.allWrites[s.allWrites.length-1].writeId:-1}(s),!0):(o.snap?s.visibleWrites=Z4(s.visibleWrites,o.path):O(o.children,c=>{s.visibleWrites=Z4(s.visibleWrites,A(o.path,c))}),!0))}(s.pendingWriteTree_,t)){let e=new B(null);return null!=o.snap?e=e.set(z(),!0):O(o.children,a=>{e=e.set(new C(a),!0)}),V1(s,new y2(o.path,e,n))}return[]}function t2(s,t,n){return V1(s,new p1({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function b2(s,t,n,o,i=!1){const e=t._path,a=s.syncPointTree_.get(e);let l=[];if(a&&("default"===t._queryIdentifier||M3(a,t))){const c=function n5(s,t,n,o){const i=t._queryIdentifier,e=[];let a=[];const l=r1(s);if("default"===i)for(const[c,r]of s.views.entries())a=a.concat(d3(r,n,o)),g3(r)&&(s.views.delete(c),r.query._queryParams.loadsAllData()||e.push(r.query));else{const c=s.views.get(i);c&&(a=a.concat(d3(c,n,o)),g3(c)&&(s.views.delete(i),c.query._queryParams.loadsAllData()||e.push(c.query)))}return l&&!r1(s)&&e.push(new(function J8(){return(0,h.vA)(O2,"Reference.ts has not been loaded"),O2}())(t._repo,t._path)),{removed:e,events:a}}(a,t,n,o);(function Z8(s){return 0===s.views.size})(a)&&(s.syncPointTree_=s.syncPointTree_.remove(e));const r=c.removed;if(l=c.events,!i){const v=-1!==r.findIndex(d=>d._queryParams.loadsAllData()),g=s.syncPointTree_.findOnPath(e,(d,w)=>r1(w));if(v&&!g){const d=s.syncPointTree_.subtree(e);if(!d.isEmpty()){const w=function v5(s){return s.fold((t,n,o)=>{if(n&&r1(n))return[E2(n)];{let i=[];return n&&(i=x3(n)),O(o,(e,a)=>{i=i.concat(a)}),i}})}(d);for(let u=0;u<w.length;++u){const _=w[u],E=_.query,b1=y3(s,_);s.listenProvider_.startListening(s2(E),n2(s,E),b1.hashFn,b1.onComplete)}}}!g&&r.length>0&&!o&&(v?s.listenProvider_.stopListening(s2(t),null):r.forEach(d=>{const w=s.queryToTagMap.get(I2(d));s.listenProvider_.stopListening(s2(d),w)}))}!function g5(s,t){for(let n=0;n<t.length;++n){const o=t[n];if(!o._queryParams.loadsAllData()){const i=I2(o),e=s.queryToTagMap.get(i);s.queryToTagMap.delete(i),s.tagToQueryMap.delete(e)}}}(s,r)}return l}function j0(s,t,n,o=!1){const i=t._path;let e=null,a=!1;s.syncPointTree_.foreachOnPath(i,(d,w)=>{const u=T(d,i);e=e||c1(w,u),a=a||r1(w)});let c,l=s.syncPointTree_.get(i);l?(a=a||r1(l),e=e||c1(l,z())):(l=new u3,s.syncPointTree_=s.syncPointTree_.set(i,l)),null!=e?c=!0:(c=!1,e=p.EMPTY_NODE,s.syncPointTree_.subtree(i).foreachChild((w,u)=>{const _=c1(u,z());_&&(e=e.updateImmediateChild(w,_))}));const r=M3(l,t);if(!r&&!t._queryParams.loadsAllData()){const d=I2(t);(0,h.vA)(!s.queryToTagMap.has(d),"View does not exist, but we have a tag");const w=function d5(){return i5++}();s.queryToTagMap.set(d,w),s.tagToQueryMap.set(w,d)}let g=t5(l,t,n,A2(s.pendingWriteTree_,i),e,c);if(!r&&!a&&!o){const d=f3(l,t);g=g.concat(function w5(s,t,n){const o=t._path,i=n2(s,t),e=y3(s,n),a=s.listenProvider_.startListening(s2(t),i,e.hashFn,e.onComplete),l=s.syncPointTree_.subtree(o);if(i)(0,h.vA)(!r1(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((r,v,g)=>{if(!f(r)&&v&&r1(v))return[E2(v).query];{let d=[];return v&&(d=d.concat(x3(v).map(w=>w.query))),O(g,(w,u)=>{d=d.concat(u)}),d}});for(let r=0;r<c.length;++r){const v=c[r];s.listenProvider_.stopListening(s2(v),n2(s,v))}}return a}(s,t,d))}return g}function T2(s,t,n){const i=s.pendingWriteTree_,e=s.syncPointTree_.findOnPath(t,(a,l)=>{const r=c1(l,T(a,t));if(r)return r});return i3(i,t,e,n,!0)}function V1(s,t){return _3(t,s.syncPointTree_,null,A2(s.pendingWriteTree_,z()))}function _3(s,t,n,o){if(f(s.path))return C3(s,t,n,o);{const i=t.get(z());null==n&&null!=i&&(n=c1(i,z()));let e=[];const a=x(s.path),l=s.operationForChild(a),c=t.children.get(a);if(c&&l){const r=n?n.getImmediateChild(a):null,v=a3(o,a);e=e.concat(_3(l,c,r,v))}return i&&(e=e.concat(O0(i,s,o,n))),e}}function C3(s,t,n,o){const i=t.get(z());null==n&&null!=i&&(n=c1(i,z()));let e=[];return t.children.inorderTraversal((a,l)=>{const c=n?n.getImmediateChild(a):null,r=a3(o,a),v=s.operationForChild(a);v&&(e=e.concat(C3(v,l,c,r)))}),i&&(e=e.concat(O0(i,s,o,n))),e}function y3(s,t){const n=t.query,o=n2(s,n);return{hashFn:()=>(function G8(s){return s.viewCache_.serverCache.getNode()}(t)||p.EMPTY_NODE).hash(),onComplete:i=>{if("ok"===i)return o?function c5(s,t,n){const o=b0(s,n);if(o){const i=T0(o),e=i.path,a=i.queryId,l=T(e,t);return I0(s,e,new $1(z0(a),l))}return[]}(s,n._path,o):function l5(s,t){return V1(s,new $1({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(s,n._path);{const e=function l6(s,t){let n="Unknown Error";"too_big"===s?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===s?n="Client doesn't have permission to access the desired data.":"unavailable"===s&&(n="The service is unavailable");const o=new Error(s+" at "+t._path.toString()+": "+n);return o.code=s.toUpperCase(),o}(i,n);return b2(s,n,null,e)}}}}function n2(s,t){const n=I2(t);return s.queryToTagMap.get(n)}function I2(s){return s._path.toString()+"$"+s._queryIdentifier}function b0(s,t){return s.tagToQueryMap.get(t)}function T0(s){const t=s.indexOf("$");return(0,h.vA)(-1!==t&&t<s.length-1,"Bad queryKey."),{queryId:s.substr(t+1),path:new C(s.substr(0,t))}}function I0(s,t,n){const o=s.syncPointTree_.get(t);return(0,h.vA)(o,"Missing sync point for query tag that we're tracking"),O0(o,n,A2(s.pendingWriteTree_,t),null)}function s2(s){return s._queryParams.loadsAllData()&&!s._queryParams.isDefault()?new(function o5(){return(0,h.vA)(j2,"Reference.ts has not been loaded"),j2}())(s._repo,s._path):s}class N0{constructor(t){this.node_=t}getImmediateChild(t){const n=this.node_.getImmediateChild(t);return new N0(n)}node(){return this.node_}}class R0{constructor(t,n){this.syncTree_=t,this.path_=n}getImmediateChild(t){const n=A(this.path_,t);return new R0(this.syncTree_,n)}node(){return T2(this.syncTree_,this.path_)}}const m5=function(s){return(s=s||{}).timestamp=s.timestamp||(new Date).getTime(),s},L3=function(s,t,n){return s&&"object"==typeof s?((0,h.vA)(".sv"in s,"Unexpected leaf node or priority contents"),"string"==typeof s[".sv"]?u5(s[".sv"],t,n):"object"==typeof s[".sv"]?p5(s[".sv"],t):void(0,h.vA)(!1,"Unexpected server value: "+JSON.stringify(s,null,2))):s},u5=function(s,t,n){if("timestamp"===s)return n.timestamp;(0,h.vA)(!1,"Unexpected server value: "+s)},p5=function(s,t,n){s.hasOwnProperty("increment")||(0,h.vA)(!1,"Unexpected server value: "+JSON.stringify(s,null,2));const o=s.increment;"number"!=typeof o&&(0,h.vA)(!1,"Unexpected increment value: "+o);const i=t.node();if((0,h.vA)(null!==i&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return o;const a=i.getValue();return"number"!=typeof a?o:a+o},B3=function(s,t,n,o){return D0(t,new R0(n,s),o)},P0=function(s,t,n){return D0(s,new N0(t),n)};function D0(s,t,n){const o=s.getPriority().val(),i=L3(o,t.getImmediateChild(".priority"),n);let e;if(s.isLeafNode()){const a=s,l=L3(a.getValue(),t,n);return l!==a.getValue()||i!==a.getPriority().val()?new y1(l,S(i)):s}{const a=s;return e=a,i!==a.getPriority().val()&&(e=e.updatePriority(new y1(i))),a.forEachChild(L,(l,c)=>{const r=D0(c,t.getImmediateChild(l),n);r!==c&&(e=e.updateImmediateChild(l,r))}),e}}class F0{constructor(t="",n=null,o={children:{},childCount:0}){this.name=t,this.parent=n,this.node=o}}function N2(s,t){let n=t instanceof C?t:new C(t),o=s,i=x(n);for(;null!==i;){const e=(0,h.yw)(o.node.children,i)||{children:{},childCount:0};o=new F0(i,o,e),n=y(n),i=x(n)}return o}function M1(s){return s.node.value}function q0(s,t){s.node.value=t,U0(s)}function A3(s){return s.node.childCount>0}function R2(s,t){O(s.node.children,(n,o)=>{t(new F0(n,s,o))})}function S3(s,t,n,o){n&&!o&&t(s),R2(s,i=>{S3(i,t,!0,o)}),n&&o&&t(s)}function o2(s){return new C(null===s.parent?s.name:o2(s.parent)+"/"+s.name)}function U0(s){null!==s.parent&&function M5(s,t,n){const o=function x5(s){return void 0===M1(s)&&!A3(s)}(n),i=(0,h.gR)(s.node.children,t);o&&i?(delete s.node.children[t],s.node.childCount--,U0(s)):!o&&!i&&(s.node.children[t]=n.node,s.node.childCount++,U0(s))}(s.parent,s.name,s)}const k5=/[\[\].#$\/\u0000-\u001F\u007F]/,z5=/[\[\].#$\u0000-\u001F\u007F]/,W0=10485760,P2=function(s){return"string"==typeof s&&0!==s.length&&!k5.test(s)},H3=function(s){return"string"==typeof s&&0!==s.length&&!z5.test(s)},K=function(s,t,n,o){o&&void 0===t||e2((0,h.dI)(s,"value"),t,n)},e2=function(s,t,n){const o=n instanceof C?new P6(n,s):n;if(void 0===t)throw new Error(s+"contains undefined "+m1(o));if("function"==typeof t)throw new Error(s+"contains a function "+m1(o)+" with contents = "+t.toString());if(w2(t))throw new Error(s+"contains "+t.toString()+" "+m1(o));if("string"==typeof t&&t.length>W0/3&&(0,h.OE)(t)>W0)throw new Error(s+"contains a string greater than "+W0+" utf8 bytes "+m1(o)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let i=!1,e=!1;if(O(t,(a,l)=>{if(".value"===a)i=!0;else if(".priority"!==a&&".sv"!==a&&(e=!0,!P2(a)))throw new Error(s+" contains an invalid key ("+a+") "+m1(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function D6(s,t){s.parts_.length>0&&(s.byteLength_+=1),s.parts_.push(t),s.byteLength_+=(0,h.OE)(t),R4(s)})(o,a),e2(s,l,o),function F6(s){const t=s.parts_.pop();s.byteLength_-=(0,h.OE)(t),s.parts_.length>0&&(s.byteLength_-=1)}(o)}),i&&e)throw new Error(s+' contains ".value" child '+m1(o)+" in addition to actual children.")}},Q0=function(s,t,n,o){if(!(o&&void 0===n||H3(n)))throw new Error((0,h.dI)(s,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},y5=function(s,t,n,o){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Q0(s,t,n,o)},$=function(s,t){if(".info"===x(t))throw new Error(s+" failed = Can't modify data under /.info/")};class L5{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function D2(s,t){let n=null;for(let o=0;o<t.length;o++){const i=t[o],e=i.getPath();null!==n&&!l0(e,n.path)&&(s.eventLists_.push(n),n=null),null===n&&(n={events:[],path:e}),n.events.push(i)}n&&s.eventLists_.push(n)}function E3(s,t,n){D2(s,n),j3(s,o=>l0(o,t))}function N(s,t,n){D2(s,n),j3(s,o=>P(o,t)||P(t,o))}function j3(s,t){s.recursionDepth_++;let n=!0;for(let o=0;o<s.eventLists_.length;o++){const i=s.eventLists_[o];i&&(t(i.path)?(B5(s.eventLists_[o]),s.eventLists_[o]=null):n=!1)}n&&(s.eventLists_=[]),s.recursionDepth_--}function B5(s){for(let t=0;t<s.events.length;t++){const n=s.events[t];if(null!==n){s.events[t]=null;const o=n.getEventRunner();Z&&V("event: "+n.toString()),_1(o)}}}const A5=25;class S5{constructor(t,n,o,i){this.repoInfo_=t,this.forceRestClient_=n,this.authTokenProvider_=o,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new L5,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=C2(),this.transactionQueueTree_=new F0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function T3(s){const n=s.infoData_.getNode(new C(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+n}function l2(s){return m5({timestamp:T3(s)})}function I3(s,t,n,o,i){s.dataUpdateCount++;const e=new C(t);n=s.interceptServerDataCallback_?s.interceptServerDataCallback_(t,n):n;let a=[];if(i)if(o){const c=(0,h.kH)(n,r=>S(r));a=function r5(s,t,n,o){const i=b0(s,o);if(i){const e=T0(i),a=e.path,l=e.queryId,c=T(a,t),r=B.fromObject(n);return I0(s,a,new S1(z0(l),c,r))}return[]}(s.serverSyncTree_,e,c,i)}else{const c=S(n);a=function z3(s,t,n,o){const i=b0(s,o);if(null!=i){const e=T0(i),a=e.path,l=e.queryId,c=T(a,t);return I0(s,a,new p1(z0(l),c,n))}return[]}(s.serverSyncTree_,e,c,i)}else if(o){const c=(0,h.kH)(n,r=>S(r));a=function a5(s,t,n){const o=B.fromObject(n);return V1(s,new S1({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,o))}(s.serverSyncTree_,e,c)}else{const c=S(n);a=t2(s.serverSyncTree_,e,c)}let l=e;a.length>0&&(l=E1(s,e)),N(s.eventQueue_,l,a)}function N3(s,t){Y0(s,"connected",t),!1===t&&function j5(s){O1(s,"onDisconnectEvents");const t=l2(s),n=C2();f0(s.onDisconnect_,z(),(i,e)=>{const a=B3(i,e,s.serverSyncTree_,t);A1(n,i,a)});let o=[];f0(n,z(),(i,e)=>{o=o.concat(t2(s.serverSyncTree_,i,e));const a=J0(s,i);E1(s,a)}),s.onDisconnect_=C2(),N(s.eventQueue_,z(),o)}(s)}function Y0(s,t,n){const o=new C("/.info/"+t),i=S(n);s.infoData_.updateSnapshot(o,i);const e=t2(s.infoSyncTree_,o,i);N(s.eventQueue_,o,e)}function F2(s){return s.nextWriteId_++}function K0(s,t,n,o,i){O1(s,"set",{path:t.toString(),value:n,priority:o});const e=l2(s),a=S(n,o),l=T2(s.serverSyncTree_,t),c=P0(a,l,e),r=F2(s),v=E0(s.serverSyncTree_,t,c,r,!0);D2(s.eventQueue_,v),s.server_.put(t.toString(),a.val(!0),(d,w)=>{const u="ok"===d;u||j("set at "+t+" failed: "+d);const _=h1(s.serverSyncTree_,r,!u);N(s.eventQueue_,t,_),function v1(s,t,n,o){t&&_1(()=>{if("ok"===n)t(null);else{const i=(n||"error").toUpperCase();let e=i;o&&(e+=": "+o);const a=new Error(e);a.code=i,t(a)}})}(0,i,d,w)});const g=J0(s,t);E1(s,g),N(s.eventQueue_,g,[])}function $0(s,t,n){let o;o=".info"===x(t._path)?b2(s.infoSyncTree_,t,n):b2(s.serverSyncTree_,t,n),E3(s.eventQueue_,t._path,o)}function O1(s,...t){let n="";s.persistentConnection_&&(n=s.persistentConnection_.id+":"),V(n,...t)}function X0(s,t,n){return T2(s.serverSyncTree_,t,n)||p.EMPTY_NODE}function q2(s,t=s.transactionQueueTree_){if(t||U2(s,t),M1(t)){const n=F3(s,t);(0,h.vA)(n.length>0,"Sending zero length transaction queue"),n.every(i=>0===i.status)&&function D5(s,t,n){const o=n.map(r=>r.currentWriteId),i=X0(s,t,o);let e=i;const a=i.hash();for(let r=0;r<n.length;r++){const v=n[r];(0,h.vA)(0===v.status,"tryToSendTransactionQueue_: items in queue should all be run."),v.status=1,v.retryCount++;const g=T(t,v.path);e=e.updateChild(g,v.currentOutputSnapshotRaw)}const l=e.val(!0),c=t;s.server_.put(c.toString(),l,r=>{O1(s,"transaction put response",{path:c.toString(),status:r});let v=[];if("ok"===r){const g=[];for(let d=0;d<n.length;d++)n[d].status=2,v=v.concat(h1(s.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&g.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();U2(s,N2(s.transactionQueueTree_,t)),q2(s,s.transactionQueueTree_),N(s.eventQueue_,t,v);for(let d=0;d<g.length;d++)_1(g[d])}else{if("datastale"===r)for(let g=0;g<n.length;g++)n[g].status=3===n[g].status?4:0;else{j("transaction at "+c.toString()+" failed: "+r);for(let g=0;g<n.length;g++)n[g].status=4,n[g].abortReason=r}E1(s,t)}},a)}(s,o2(t),n)}else A3(t)&&R2(t,n=>{q2(s,n)})}function E1(s,t){const n=D3(s,t),o=o2(n);return function F5(s,t,n){if(0===t.length)return;const o=[];let i=[];const a=t.filter(l=>0===l.status).map(l=>l.currentWriteId);for(let l=0;l<t.length;l++){const c=t[l],r=T(n,c.path);let g,v=!1;if((0,h.vA)(null!==r,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)v=!0,g=c.abortReason,i=i.concat(h1(s.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=A5)v=!0,g="maxretry",i=i.concat(h1(s.serverSyncTree_,c.currentWriteId,!0));else{const d=X0(s,c.path,a);c.currentInputSnapshot=d;const w=t[l].update(d.val());if(void 0!==w){e2("transaction failed: Data returned ",w,c.path);let u=S(w);"object"==typeof w&&null!=w&&(0,h.gR)(w,".priority")||(u=u.updatePriority(d.getPriority()));const E=c.currentWriteId,b1=l2(s),Y2=P0(u,d,b1);c.currentOutputSnapshotRaw=u,c.currentOutputSnapshotResolved=Y2,c.currentWriteId=F2(s),a.splice(a.indexOf(E),1),i=i.concat(E0(s.serverSyncTree_,c.path,Y2,c.currentWriteId,c.applyLocally)),i=i.concat(h1(s.serverSyncTree_,E,!0))}else v=!0,g="nodata",i=i.concat(h1(s.serverSyncTree_,c.currentWriteId,!0))}N(s.eventQueue_,n,i),i=[],v&&(t[l].status=2,setTimeout(t[l].unwatcher,Math.floor(0)),t[l].onComplete&&o.push("nodata"===g?()=>t[l].onComplete(null,!1,t[l].currentInputSnapshot):()=>t[l].onComplete(new Error(g),!1,null)))}U2(s,s.transactionQueueTree_);for(let l=0;l<o.length;l++)_1(o[l]);q2(s,s.transactionQueueTree_)}(s,F3(s,n),o),o}function D3(s,t){let n,o=s.transactionQueueTree_;for(n=x(t);null!==n&&void 0===M1(o);)o=N2(o,n),n=x(t=y(t));return o}function F3(s,t){const n=[];return q3(s,t,n),n.sort((o,i)=>o.order-i.order),n}function q3(s,t,n){const o=M1(t);if(o)for(let i=0;i<o.length;i++)n.push(o[i]);R2(t,i=>{q3(s,i,n)})}function U2(s,t){const n=M1(t);if(n){let o=0;for(let i=0;i<n.length;i++)2!==n[i].status&&(n[o]=n[i],o++);n.length=o,q0(t,n.length>0?n:void 0)}R2(t,o=>{U2(s,o)})}function J0(s,t){const n=o2(D3(s,t)),o=N2(s.transactionQueueTree_,t);return function f5(s,t,n){let o=n?s:s.parent;for(;null!==o;){if(t(o))return!0;o=o.parent}}(o,i=>{Z0(s,i)}),Z0(s,o),S3(o,i=>{Z0(s,i)}),n}function Z0(s,t){const n=M1(t);if(n){const o=[];let i=[],e=-1;for(let a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?((0,h.vA)(e===a-1,"All SENT items should be at beginning of queue."),e=a,n[a].status=3,n[a].abortReason="set"):((0,h.vA)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat(h1(s.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&o.push(n[a].onComplete.bind(null,new Error("set"),!1,null))));-1===e?q0(t,void 0):n.length=e+1,N(s.eventQueue_,o2(t),i);for(let a=0;a<o.length;a++)_1(o[a])}}const t4=function(s,t){const n=W5(s),o=n.namespace;return"firebase.com"===n.domain&&G(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!o||"undefined"===o)&&"localhost"!==n.domain&&G("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&j("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new t0(n.host,n.secure,o,"ws"===n.scheme||"wss"===n.scheme,t,"",o!==n.subdomain),path:new C(n.pathString)}},W5=function(s){let t="",n="",o="",i="",e="",a=!0,l="https",c=443;if("string"==typeof s){let r=s.indexOf("//");r>=0&&(l=s.substring(0,r-1),s=s.substring(r+2));let v=s.indexOf("/");-1===v&&(v=s.length);let g=s.indexOf("?");-1===g&&(g=s.length),t=s.substring(0,Math.min(v,g)),v<g&&(i=function q5(s){let t="";const n=s.split("/");for(let o=0;o<n.length;o++)if(n[o].length>0){let i=n[o];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}t+="/"+i}return t}(s.substring(v,g)));const d=function U5(s){const t={};"?"===s.charAt(0)&&(s=s.substring(1));for(const n of s.split("&")){if(0===n.length)continue;const o=n.split("=");2===o.length?t[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):j(`Invalid query segment '${n}' in query '${s}'`)}return t}(s.substring(Math.min(s.length,g)));r=t.indexOf(":"),r>=0?(a="https"===l||"wss"===l,c=parseInt(t.substring(r+1),10)):r=t.length;const w=t.slice(0,r);if("localhost"===w.toLowerCase())n="localhost";else if(w.split(".").length<=2)n=w;else{const u=t.indexOf(".");o=t.substring(0,u).toLowerCase(),n=t.substring(u+1),e=o}"ns"in d&&(e=d.ns)}return{host:t,port:c,domain:n,subdomain:o,secure:a,scheme:l,pathString:i,namespace:e}};class W3{constructor(t,n,o,i){this.eventType=t,this.eventRegistration=n,this.snapshot=o,this.prevName=i}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,h.As)(this.snapshot.exportVal())}}class G3{constructor(t,n,o){this.eventRegistration=t,this.error=n,this.path=o}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class n4{constructor(t,n){this.snapshotCallback=t,this.cancelCallback=n}onValue(t,n){this.snapshotCallback.call(null,t,n)}onCancel(t){return(0,h.vA)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class R{constructor(t,n,o,i){this._repo=t,this._path=n,this._queryParams=o,this._orderByCalled=i}get key(){return f(this._path)?null:a0(this._path)}get ref(){return new q(this._repo,this._path)}get _queryIdentifier(){const t=$4(this._queryParams),n=J2(t);return"{}"===n?"default":n}get _queryObject(){return $4(this._queryParams)}isEqual(t){if(!((t=(0,h.Ku)(t))instanceof R))return!1;const n=this._repo===t._repo,o=l0(this._path,t._path);return n&&o&&this._queryIdentifier===t._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function N6(s){let t="";for(let n=s.pieceNum_;n<s.pieces_.length;n++)""!==s.pieces_[n]&&(t+="/"+encodeURIComponent(String(s.pieces_[n])));return t||"/"}(this._path)}}class q extends R{constructor(t,n){super(t,n,new m0,!1)}get parent(){const t=N4(this._path);return null===t?null:new q(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class k1{constructor(t,n,o){this._node=t,this.ref=n,this._index=o}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const n=new C(t),o=j1(this.ref,t);return new k1(this._node.getChild(n),o,L)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(o,i)=>t(new k1(i,j1(this.ref,o),L)))}hasChild(t){const n=new C(t);return!this._node.getChild(n).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Q3(s,t){return(s=(0,h.Ku)(s))._checkNotDeleted("ref"),void 0!==t?j1(s._root,t):s._root}function j1(s,t){return null===x((s=(0,h.Ku)(s))._path)?y5("child","path",t,!1):Q0("child","path",t,!1),new q(s._repo,A(s._path,t))}function s4(s,t){s=(0,h.Ku)(s),$("set",s._path),K("set",t,s._path,!1);const n=new h.cY;return K0(s._repo,s._path,t,null,n.wrapCallback(()=>{})),n.promise}class c2{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,n){const o=n._queryParams.getIndex();return new W3("value",this,new k1(t.snapshotNode,new q(n._repo,n._path),o))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,n){return this.callbackContext.hasCancelCallback?new G3(this,t,n):null}matches(t){return t instanceof c2&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Q2{constructor(t,n){this.eventType=t,this.callbackContext=n}respondsTo(t){let n="children_added"===t?"child_added":t;return n="children_removed"===n?"child_removed":n,this.eventType===n}createCancelEvent(t,n){return this.callbackContext.hasCancelCallback?new G3(this,t,n):null}createEvent(t,n){(0,h.vA)(null!=t.childName,"Child events should have a childName.");const o=j1(new q(n._repo,n._path),t.childName),i=n._queryParams.getIndex();return new W3(t.type,this,new k1(t.snapshotNode,o,i),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof Q2&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Y3(s,t,n,o){return function r2(s,t,n,o,i){let e;if("object"==typeof o&&(e=void 0,i=o),"function"==typeof o&&(e=o),i&&i.onlyOnce){const c=n,r=(v,g)=>{$0(s._repo,s,l),c(v,g)};r.userCallback=n.userCallback,r.context=n.context,n=r}const a=new n4(n,e||void 0),l="value"===t?new c2(a):new Q2(t,a);return function N5(s,t,n){let o;o=".info"===x(t._path)?j0(s.infoSyncTree_,t,n):j0(s.serverSyncTree_,t,n),E3(s.eventQueue_,t._path,o)}(s._repo,s,l),()=>$0(s._repo,s,l)}(s,"value",t,n,o)}(function X8(s){(0,h.vA)(!O2,"__referenceConstructor has already been defined"),O2=s})(q),function s5(s){(0,h.vA)(!j2,"__referenceConstructor has already been defined"),j2=s}(q);const o4={};function J3(s,t,n,o,i){let e=o||s.options.databaseURL;void 0===e&&(s.options.projectId||G("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),V("Using default host for project ",s.options.projectId),e=`${s.options.projectId}-default-rtdb.firebaseio.com`);let c,r,a=t4(e,i),l=a.repoInfo;typeof process<"u"&&process.env&&(r=process.env.FIREBASE_DATABASE_EMULATOR_HOST),r?(c=!0,e=`http://${r}?ns=${l.namespace}`,a=t4(e,i),l=a.repoInfo):c=!a.repoInfo.secure;const v=i&&c?new F1(F1.OWNER):new d6(s.name,s.options,t);(function(s,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!P2(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(s){return s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),H3(s)}(n))throw new Error((0,h.dI)(s,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",a),f(a.path)||G("Database URL must point to the root of a Firebase Database (not including a child path).");const g=function at(s,t,n,o){let i=o4[t.name];i||(i={},o4[t.name]=i);let e=i[s.toURLString()];return e&&G("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),e=new S5(s,false,n,o),i[s.toURLString()]=e,e}(l,s,v,new g6(s.name,n));return new ct(g,s)}class ct{constructor(t,n){this._repoInternal=t,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function H5(s,t,n){if(s.stats_=o0(s.repoInfo_),s.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)s.server_=new _2(s.repoInfo_,(o,i,e,a)=>{I3(s,o,i,e,a)},s.authTokenProvider_,s.appCheckProvider_),setTimeout(()=>N3(s,!0),0);else{if(typeof n<"u"&&null!==n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,h.As)(n)}catch(o){throw new Error("Invalid authOverride provided: "+o)}}s.persistentConnection_=new u1(s.repoInfo_,t,(o,i,e,a)=>{I3(s,o,i,e,a)},o=>{N3(s,o)},o=>{!function V5(s,t){O(t,(n,o)=>{Y0(s,n,o)})}(s,o)},s.authTokenProvider_,s.appCheckProvider_,n),s.server_=s.persistentConnection_}s.authTokenProvider_.addTokenChangeListener(o=>{s.server_.refreshAuthToken(o)}),s.appCheckProvider_.addTokenChangeListener(o=>{s.server_.refreshAppCheckToken(o.token)}),s.statsReporter_=function u6(s,t){const n=s.toString();return s0[n]||(s0[n]=t()),s0[n]}(s.repoInfo_,()=>new u8(s.stats_,s.server_)),s.infoData_=new v8,s.infoSyncTree_=new k3({startListening:(o,i,e,a)=>{let l=[];const c=s.infoData_.getNode(o._path);return c.isEmpty()||(l=t2(s.infoSyncTree_,o._path,c),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),Y0(s,"connected",!1),s.serverSyncTree_=new k3({startListening:(o,i,e,a)=>(s.server_.listen(o,e,i,(l,c)=>{const r=a(l,c);N(s.eventQueue_,o._path,r)}),[]),stopListening:(o,i)=>{s.server_.unlisten(o,i)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new q(this._repo,z())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function et(s,t){const n=o4[t];(!n||n[s.key]!==s)&&G(`Database ${t}(${s.repoInfo_}) has already been deleted.`),function P3(s){s.persistentConnection_&&s.persistentConnection_.interrupt("repo_interrupt")}(s),delete n[s.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&G("Cannot call "+t+" on a deleted database.")}}function rt(s=(0,J.Sx)(),t){const n=(0,J.j6)(s,"database").getImmediate({identifier:t});if(!n._instanceStarted){const o=(0,h.yU)("database");o&&function ht(s,t,n,o={}){(s=(0,h.Ku)(s))._checkNotDeleted("useEmulator"),s._instanceStarted&&G("Cannot call useEmulator() after instance has already been initialized.");const i=s._repoInternal;let e;if(i.repoInfo_.nodeAdmin)o.mockUserToken&&G('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),e=new F1(F1.OWNER);else if(o.mockUserToken){const a="string"==typeof o.mockUserToken?o.mockUserToken:(0,h.Fy)(o.mockUserToken,s.app.options.projectId);e=new F1(a)}!function it(s,t,n,o){s.repoInfo_=new t0(`${t}:${n}`,!1,s.repoInfo_.namespace,s.repoInfo_.webSocketOnly,s.repoInfo_.nodeAdmin,s.repoInfo_.persistenceKey,s.repoInfo_.includeNamespaceInQueryParams,!0),o&&(s.authTokenProvider_=o)}(i,t,n,e)}(n,...o)}return n}u1.prototype.simpleListen=function(s,t){this.sendRequest("q",{p:s},t)},u1.prototype.echo=function(s,t){this.sendRequest("echo",{d:s},t)},function t6(s){(function I1(s){d1=s})(J.MF),(0,J.om)(new K2.uA("database",(t,{instanceIdentifier:n})=>J3(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),n),"PUBLIC").setMultipleInstances(!0)),(0,J.KO)(g2,"1.0.8",s),(0,J.KO)(g2,"1.0.8","esm2017")}()},5873:(n6,h2,X)=>{X.d(h2,{DQR:()=>s3,YH_:()=>v2,f_X:()=>t6,ov$:()=>gt});const v2="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48zm80 224h-64v64a16 16 0 01-32 0v-64h-64a16 16 0 010-32h64v-64a16 16 0 0132 0v64h64a16 16 0 010 32z'/></svg>",s3="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M321.94 98L158.82 237.78a24 24 0 000 36.44L321.94 414c15.57 13.34 39.62 2.28 39.62-18.22v-279.6c0-20.5-24.05-31.56-39.62-18.18z'/></svg>",t6="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M432 448a15.92 15.92 0 01-11.31-4.69l-352-352a16 16 0 0122.62-22.62l352 352A16 16 0 01432 448zM255.66 384c-41.49 0-81.5-12.28-118.92-36.5-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 00.14-2.94L93.5 161.38a2 2 0 00-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 00-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0075.8-12.58 2 2 0 00.77-3.31l-21.58-21.58a4 4 0 00-3.83-1 204.8 204.8 0 01-51.16 6.47zM490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 00-74.89 12.83 2 2 0 00-.75 3.31l21.55 21.55a4 4 0 003.88 1 192.82 192.82 0 0150.21-6.69c40.69 0 80.58 12.43 118.55 37 34.71 22.4 65.74 53.88 89.76 91a.13.13 0 010 .16 310.72 310.72 0 01-64.12 72.73 2 2 0 00-.15 2.95l19.9 19.89a2 2 0 002.7.13 343.49 343.49 0 0068.64-78.48 32.2 32.2 0 00-.1-34.78z'/><path d='M256 160a95.88 95.88 0 00-21.37 2.4 2 2 0 00-1 3.38l112.59 112.56a2 2 0 003.38-1A96 96 0 00256 160zM165.78 233.66a2 2 0 00-3.38 1 96 96 0 00115 115 2 2 0 001-3.38z'/></svg>",gt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 00-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 000-17.47C428.89 172.28 347.8 112 255.66 112z' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><circle cx='256' cy='256' r='80' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/></svg>"}}]);